# 用户权限管理需求文档

## 1. 概述
本项目采用 **RBAC (Role-Based Access Control)** 基于角色的访问控制模型，结合 **JWT (JSON Web Token)** 实现无状态 API 认证。

## 2. 安全架构
- **认证方式**: Bearer Token (JWT)
- **令牌机制**: 双令牌模式
  - `Access Token`: 有效期短 (如 15分钟)，用于访问受保护资源。
  - `Refresh Token`: 有效期长 (如 7天)，仅用于换取新的 Access Token。
- **密码存储**: PBKDF2 + SHA256 哈希 (Werkzeug security)。

## 3. 数据库模型设计

### 3.1 `users` (用户表)
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | Integer | PK |
| username | String | 登录名 (唯一) |
| email | String | 邮箱 (唯一) |
| password_hash | String | 加密后的密码 |
| is_active | Boolean | 账户状态 (True=启用) |
| created_at | Datetime | 创建时间 |

### 3.2 `roles` (角色表)
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| id | Integer | PK |
| name | String | 角色标识 (如 admin, editor) |
| description | String | 角色描述 |

### 3.3 `user_roles` (关联表)
多对多关系表，连接 User 和 Role。

## 4. API 接口规划

### 4.1 认证 (Auth)
- `POST /api/v1/auth/login`: 用户登录
  - Input: `{username, password}`
  - Output: `{access_token, refresh_token, user_info}`
- `POST /api/v1/auth/refresh`: 刷新令牌
  - Header: `Authorization: Bearer <refresh_token>`
  - Output: `{access_token}`
- `GET /api/v1/auth/me`: 获取当前用户信息
  - Header: `Authorization: Bearer <access_token>`

### 4.2 用户管理 (User Management) - Admin Only
- `POST /api/v1/users`: 创建新用户 (分配角色)
- `GET /api/v1/users`: 用户列表
- `PUT /api/v1/users/{id}`: 修改用户状态/角色
- `DELETE /api/v1/users/{id}`: 删除用户

## 5. 权限控制策略 (示例)
- **无需登录**: 登录接口, 公开查询接口(如果有)
- **需登录**: 查看产品列表, 查看个人信息
- **需 Editor 角色**: 创建/修改产品, 生成特征码
- **需 Admin 角色**: 创建用户, 修改分类树结构

## 6. 模拟数据策略 (Seeding)
为方便开发调试，`flask seed-db` 命令将预置以下账户：

### 6.1 超级管理员 (Admin)
- **Username**: `admin`
- **Password**: `password`
- **Role**: `admin`
- **权限**: 拥有系统最高权限，可管理用户、角色、所有分类和产品。

### 6.2 内容编辑 (Editor)
- **Username**: `editor`
- **Password**: `editor123`
- **Role**: `editor`
- **权限**: 仅限产品管理 (创建、编辑产品)，无法进入用户管理模块。

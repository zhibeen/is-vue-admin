# æ—¥å¿—ç³»ç»Ÿå‡çº§å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ç¯å¢ƒè‡ªé€‚åº”æ—¥å¿—é…ç½®

**æ–‡ä»¶**: `backend/app/logging_config.py`

#### åŠŸèƒ½ç‰¹æ€§

- âœ… æ ¹æ® `FLASK_ENV` è‡ªåŠ¨åˆ‡æ¢é…ç½®ï¼ˆdevelopment / production / stagingï¼‰
- âœ… æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–æ—¥å¿—çº§åˆ«ï¼ˆ`LOG_LEVEL`ã€`SQL_LOG_LEVEL`ï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒå•ç‹¬é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼ˆ`error.log`ï¼‰
- âœ… é¢„ç•™é˜¿é‡Œäº‘ SLS é›†æˆæ¥å£

#### ç¯å¢ƒé…ç½®å¯¹æ¯”

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ |
|-------|---------|---------|---------|
| æ—¥å¿—çº§åˆ« | DEBUG | INFO | INFO |
| SQL æ—¥å¿— | WARNING | ERROR | WARNING |
| æ§åˆ¶å°æ ¼å¼ | è¯¦ç»†æ˜“è¯» | JSON | è¯¦ç»† |
| æ–‡ä»¶æ ¼å¼ | JSON | JSON | JSON |
| ä¿ç•™å¤©æ•° | 30 | 90 | 60 |
| é”™è¯¯å•ç‹¬è®°å½• | âŒ | âœ… | âŒ |
| SLS æ”¯æŒ | âŒ | âœ… | âŒ |

### 2. ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

**æ–‡ä»¶**: `backend/env.example`

åŒ…å«æ‰€æœ‰ç¯å¢ƒå˜é‡è¯´æ˜ï¼š
- åŸºç¡€é…ç½®ï¼ˆFlaskã€æ•°æ®åº“ã€Redisï¼‰
- æ—¥å¿—é…ç½®ï¼ˆçº§åˆ«ã€SLS å¼€å…³ï¼‰
- é˜¿é‡Œäº‘ SLS é…ç½®ï¼ˆå‡­è¯ã€Endpointï¼‰
- å…¶ä»–æœåŠ¡é…ç½®ï¼ˆNASã€é¢†æ˜Ÿ ERPï¼‰

### 3. å®Œæ•´æ–‡æ¡£

#### æ ¸å¿ƒæ–‡æ¡£

1. **`backend/docs/é˜¿é‡Œäº‘SLSé›†æˆæŒ‡å—.md`**ï¼ˆæœ€è¯¦ç»†ï¼‰
   - ä¸ºä»€ä¹ˆéœ€è¦ SLS
   - å®Œæ•´é›†æˆæ­¥éª¤
   - AI æ—¥å¿—åˆ†æé…ç½®
   - æ¯æ—¥æŠ¥å‘Šç”Ÿæˆ
   - æˆæœ¬ä¼°ç®—

2. **`backend/docs/æ—¥å¿—ç³»ç»Ÿå®æ–½æŒ‡å—.md`**ï¼ˆå¿«é€Ÿä¸Šæ‰‹ï¼‰
   - å¼€å‘ vs ç”Ÿäº§å¯¹æ¯”
   - åˆ†é˜¶æ®µå®æ–½æ­¥éª¤
   - æ¨èæ–¹æ¡ˆ
   - å¸¸è§é—®é¢˜

3. **`backend/docs/ç”Ÿäº§ç¯å¢ƒä¾èµ–è¯´æ˜.md`**
   - é˜¿é‡Œäº‘ SDK å®‰è£…è¯´æ˜

---

## ğŸ¯ å…³é”®é—®é¢˜è§£ç­”

### Q: å¦‚ä½•åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒï¼Ÿ

**A**: é€šè¿‡ `FLASK_ENV` ç¯å¢ƒå˜é‡è‡ªåŠ¨åˆ‡æ¢

```bash
# å¼€å‘ç¯å¢ƒ
FLASK_ENV=development  # è¯¦ç»†æ—¥å¿—ã€æ˜“è¯»æ ¼å¼

# ç”Ÿäº§ç¯å¢ƒ
FLASK_ENV=production   # ç²¾ç®€æ—¥å¿—ã€JSON æ ¼å¼ã€é”™è¯¯å•ç‹¬è®°å½•
```

**ç«‹å³ç”Ÿæ•ˆ**ï¼šé‡å¯åç«¯æœåŠ¡å³å¯
```bash
docker compose restart backend
```

---

### Q: é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡æœ‰ AI åŠŸèƒ½å—ï¼Ÿ

**A**: âœ… **æœ‰ï¼** é˜¿é‡Œäº‘ SLS æä¾›å¤šç§ AI èƒ½åŠ›ï¼š

#### å†…ç½® AI åŠŸèƒ½

1. **æ™ºèƒ½å·¡æ£€**
   - è‡ªåŠ¨å‘ç°æ—¥å¿—å¼‚å¸¸
   - åŸºäºæœºå™¨å­¦ä¹ 
   - æ— éœ€é…ç½®è§„åˆ™

2. **æ ¹å› åˆ†æ**
   - æ•…éšœè‡ªåŠ¨è¯Šæ–­
   - å…³è”åˆ†æ
   - ç”Ÿæˆä¿®å¤å»ºè®®

3. **æ™ºèƒ½å‘Šè­¦é™å™ª**
   - åˆå¹¶ç›¸ä¼¼å‘Šè­¦
   - è‡ªåŠ¨ä¼˜å…ˆçº§æ’åº

4. **é€šä¹‰åƒé—®é›†æˆ**
   - è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ—¥å¿—
   - è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
   - å¯¹è¯å¼è¿ç»´

#### æ¯æ—¥æŠ¥å‘Šç”Ÿæˆ

**ä¸¤ç§æ–¹å¼**ï¼š

**æ–¹å¼ 1: SLS æ§åˆ¶å°é…ç½®ï¼ˆæ¨èï¼‰**
- åœ¨æ§åˆ¶å°åˆ›å»º"å®šæ—¶ SQL ä»»åŠ¡"
- é€‰æ‹©"AI åˆ†æ"
- é…ç½®é€šçŸ¥æ¸ é“ï¼ˆé’‰é’‰/é‚®ä»¶ï¼‰
- **æ— éœ€ç¼–ç¨‹**

**æ–¹å¼ 2: è‡ªå®šä¹‰ Python è„šæœ¬**
- ç¼–å†™å®šæ—¶ä»»åŠ¡è„šæœ¬
- è°ƒç”¨ SLS API æŸ¥è¯¢æ—¥å¿—
- è°ƒç”¨ AI ç”ŸæˆæŠ¥å‘Š
- å‘é€é€šçŸ¥

#### æŠ¥å‘Šç¤ºä¾‹

AI æ¯æ—¥ç”Ÿæˆçš„æŠ¥å‘ŠåŒ…å«ï¼š
- ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆï¼ˆæ—¥å¿—ç»Ÿè®¡ã€é”™è¯¯ç‡ï¼‰
- âš ï¸ é—®é¢˜æ€»ç»“ï¼ˆä¸»è¦é”™è¯¯åŠåŸå› ï¼‰
- ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼ˆé’ˆå¯¹æ€§å»ºè®®ï¼‰
- ğŸ“ˆ è¶‹åŠ¿åˆ†æï¼ˆå¯¹æ¯”å‰ä¸€å¤©ï¼‰
- âœ… å¥åº·è¯„åˆ†ï¼ˆ0-100ï¼‰

**æˆæœ¬**: AI åˆ†æçº¦ Â¥10-20/æœˆ

---

### Q: å¦‚ä½•å¼•å…¥é˜¿é‡Œäº‘ SLSï¼Ÿ

**A**: åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œå¾ªåºæ¸è¿›

#### ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡ï¼ˆ5 åˆ†é’Ÿï¼‰

1. æ³¨å†Œé˜¿é‡Œäº‘è´¦å·ï¼Œå¼€é€š"æ—¥å¿—æœåŠ¡"
2. åˆ›å»º Project å’Œ Logstore
3. è·å– AccessKey ID å’Œ Secret

#### ç¬¬äºŒé˜¶æ®µï¼šé›†æˆï¼ˆ30 åˆ†é’Ÿï¼‰

```bash
# 1. å®‰è£… SDK
pip install aliyun-log-python-sdk

# 2. é…ç½®ç¯å¢ƒå˜é‡
ENABLE_ALIYUN_SLS=true
ALIYUN_ACCESS_KEY_ID=your-key
ALIYUN_ACCESS_KEY_SECRET=your-secret
ALIYUN_SLS_ENDPOINT=https://cn-hangzhou.log.aliyuncs.com
ALIYUN_SLS_PROJECT=is-vue-admin-prod
ALIYUN_SLS_LOGSTORE=app-logs

# 3. é‡å¯æœåŠ¡
docker compose restart backend

# 4. éªŒè¯
docker compose logs backend | grep -i "sls"
```

#### ç¬¬ä¸‰é˜¶æ®µï¼šé…ç½® AIï¼ˆ1 å°æ—¶ï¼‰

åœ¨ SLS æ§åˆ¶å°é…ç½®ï¼š
1. æ™ºèƒ½å·¡æ£€ï¼ˆè‡ªåŠ¨å‘ç°å¼‚å¸¸ï¼‰
2. å‘Šè­¦è§„åˆ™ï¼ˆé’‰é’‰/é‚®ä»¶é€šçŸ¥ï¼‰
3. æ¯æ—¥æŠ¥å‘Šï¼ˆAI ç”Ÿæˆè¿ç»´æŠ¥å‘Šï¼‰

**è¯¦ç»†æ­¥éª¤**: æŸ¥çœ‹ `backend/docs/é˜¿é‡Œäº‘SLSé›†æˆæŒ‡å—.md`

---

### Q: éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Ÿ

**A**: ä¸‰ç±»å‡†å¤‡å·¥ä½œ

#### æŠ€æœ¯å‡†å¤‡

- âœ… é˜¿é‡Œäº‘è´¦å·ï¼ˆå·²æœ‰åˆ™è·³è¿‡ï¼‰
- âœ… è®¿é—®å‡­è¯ï¼ˆAccessKeyï¼‰
- âœ… Python SDKï¼ˆ`aliyun-log-python-sdk`ï¼‰
- âœ… ç¯å¢ƒå˜é‡é…ç½®

#### é…ç½®å‡†å¤‡

```bash
# å¿…éœ€é…ç½®
ALIYUN_ACCESS_KEY_ID       # è®¿é—®å‡­è¯
ALIYUN_ACCESS_KEY_SECRET   # è®¿é—®å¯†é’¥
ALIYUN_SLS_ENDPOINT        # åœ°åŸŸ Endpoint
ALIYUN_SLS_PROJECT         # é¡¹ç›®åç§°
ALIYUN_SLS_LOGSTORE        # æ—¥å¿—åº“åç§°

# å¯é€‰é…ç½®
LOG_LEVEL                  # æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤ INFOï¼‰
SQL_LOG_LEVEL              # SQL æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤ ERRORï¼‰
```

#### æˆæœ¬å‡†å¤‡

**å°è§„æ¨¡åº”ç”¨**ï¼ˆæ¯å¤© 1GB æ—¥å¿—ï¼‰:
- SLS åŸºç¡€: Â¥25/æœˆ
- AI åˆ†æ: Â¥10-20/æœˆ
- **æ€»è®¡**: Â¥35-45/æœˆ

**å»ºè®®**: å…ˆç”¨æŒ‰é‡ä»˜è´¹ï¼Œç¨³å®šåè´­ä¹°èµ„æºåŒ…ï¼ˆçœ 30%ï¼‰

---

## ğŸ“‹ å®æ–½æ¸…å•

### âœ… ç«‹å³å¯ç”¨ï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰

- [x] ç¯å¢ƒè‡ªé€‚åº”æ—¥å¿—é…ç½®
- [x] å¼€å‘ç¯å¢ƒè¯¦ç»†æ—¥å¿—ï¼ˆDEBUGï¼‰
- [x] ç”Ÿäº§ç¯å¢ƒç²¾ç®€æ—¥å¿—ï¼ˆINFOï¼‰
- [x] ç”Ÿäº§ç¯å¢ƒé”™è¯¯å•ç‹¬è®°å½•
- [x] JSON æ ¼å¼ç»“æ„åŒ–æ—¥å¿—
- [x] è‡ªåŠ¨æ—¥å¿—è½®è½¬ï¼ˆä¿ç•™ 30-90 å¤©ï¼‰

### ğŸ”² éœ€è¦é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

- [ ] å®‰è£…é˜¿é‡Œäº‘ SDK
- [ ] é…ç½® SLS å‡­è¯
- [ ] å¯ç”¨ SLS æ—¥å¿—ä¸Šä¼ 
- [ ] éªŒè¯æ—¥å¿—æ”¶é›†
- [ ] é…ç½®ç´¢å¼•å’ŒæŸ¥è¯¢
- [ ] è®¾ç½®æ™ºèƒ½å·¡æ£€
- [ ] é…ç½®å‘Šè­¦é€šçŸ¥
- [ ] é…ç½® AI æ¯æ—¥æŠ¥å‘Š

### ğŸ”² å¯é€‰å¢å¼º

- [ ] æ ¹å› åˆ†æ
- [ ] é€šä¹‰åƒé—®å¯¹è¯
- [ ] è‡ªå®šä¹‰ä»ªè¡¨ç›˜
- [ ] å¤šæ¸ é“å‘Šè­¦ï¼ˆé’‰é’‰/ä¼ä¸šå¾®ä¿¡/é‚®ä»¶ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš

1. **éªŒè¯ç¯å¢ƒåŒºåˆ†æ˜¯å¦ç”Ÿæ•ˆ**
   ```bash
   # æŸ¥çœ‹å½“å‰æ—¥å¿—é…ç½®
   docker compose logs backend | grep "Logging configured"
   
   # åº”è¯¥çœ‹åˆ°: "Logging configured successfully for development environment"
   ```

2. **æµ‹è¯• SQL æ—¥å¿—æŸ¥çœ‹**ï¼ˆå¼€å‘ç¯å¢ƒè°ƒè¯•æ—¶ï¼‰
   ```bash
   # ä¸´æ—¶æŸ¥çœ‹ SQL
   echo "SQL_LOG_LEVEL=INFO" >> backend/.env
   docker compose restart backend
   ```

### å‡†å¤‡ç”Ÿäº§ç¯å¢ƒ

1. **åˆ›å»ºç”Ÿäº§é…ç½®æ–‡ä»¶**
   ```bash
   cp backend/env.example backend/.env.production
   # ç¼–è¾‘ .env.productionï¼Œè®¾ç½®ç”Ÿäº§ç¯å¢ƒå‚æ•°
   ```

2. **æµ‹è¯•ç”Ÿäº§é…ç½®**ï¼ˆåœ¨æµ‹è¯•æœåŠ¡å™¨ï¼‰
   ```bash
   docker compose --env-file backend/.env.production up -d
   ```

### å¼•å…¥é˜¿é‡Œäº‘ SLSï¼ˆæ¨èæ—¶æœºï¼‰

**å»ºè®®æ—¶æœº**ï¼š
- âœ… å‡†å¤‡ä¸Šçº¿ç”Ÿäº§ç¯å¢ƒ
- âœ… éœ€è¦å¤šæœåŠ¡å™¨æ—¥å¿—èšåˆ
- âœ… éœ€è¦æ™ºèƒ½å‘Šè­¦å’Œåˆ†æ
- âœ… å›¢é˜Ÿè§„æ¨¡ > 3 äºº

**ä¸æ€¥äºå¼•å…¥**ï¼š
- å¼€å‘é˜¶æ®µ
- å•æœåŠ¡å™¨éƒ¨ç½²
- é¢„ç®—æœ‰é™

---

## ğŸ“š ç›¸å…³æ–‡æ¡£ç´¢å¼•

### æ ¸å¿ƒæ–‡æ¡£

1. **`backend/docs/é˜¿é‡Œäº‘SLSé›†æˆæŒ‡å—.md`**
   - æœ€è¯¦ç»†çš„é›†æˆæ–‡æ¡£
   - AI åŠŸèƒ½é…ç½®
   - æˆæœ¬åˆ†æ

2. **`backend/docs/æ—¥å¿—ç³»ç»Ÿå®æ–½æŒ‡å—.md`**
   - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
   - ç¯å¢ƒå¯¹æ¯”
   - å¸¸è§é—®é¢˜

3. **`backend/env.example`**
   - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
   - æ‰€æœ‰å‚æ•°è¯´æ˜

### ä»£ç æ–‡ä»¶

- **`backend/app/logging_config.py`**: æ—¥å¿—é…ç½®æ ¸å¿ƒé€»è¾‘
- **`backend/app/__init__.py`**: æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

### å¿«é€Ÿé—®é¢˜

**Q**: å¦‚ä½•æŸ¥çœ‹å½“å‰æ—¥å¿—çº§åˆ«ï¼Ÿ
```bash
docker compose exec backend python -c "import os; print(f'Environment: {os.getenv(\"FLASK_ENV\", \"development\")}')"
```

**Q**: å¦‚ä½•ä¸´æ—¶å¯ç”¨ DEBUG æ—¥å¿—ï¼Ÿ
```bash
# æ–¹æ³•1: ç¯å¢ƒå˜é‡
export LOG_LEVEL=DEBUG
docker compose restart backend

# æ–¹æ³•2: ä¿®æ”¹ .env
echo "LOG_LEVEL=DEBUG" >> .env
docker compose restart backend
```

**Q**: ç”Ÿäº§ç¯å¢ƒæ—¥å¿—åœ¨å“ªé‡Œï¼Ÿ
```bash
# å®¹å™¨å†…è·¯å¾„
/app/logs/app.log    # æ‰€æœ‰æ—¥å¿—
/app/logs/error.log  # ä»…é”™è¯¯æ—¥å¿—

# æŸ¥çœ‹
docker compose exec backend tail -f /app/logs/app.log
```

### æ·±åº¦é—®é¢˜

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»å›¢é˜Ÿã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-20  
**é€‚ç”¨ç‰ˆæœ¬**: IS-Vue-Admin v1.0+


# 前端错误捕获工具使用说明

## 🎯 功能概述

我已经为项目添加了一套完整的前端错误捕获和快速复制系统，帮助您更高效地向 Cursor AI 报告错误。

## ✨ 功能特性

### 1. **自动错误捕获**
系统会自动捕获以下类型的错误：
- ✅ Vue 组件错误
- ✅ JavaScript 运行时错误
- ✅ Promise 未捕获错误
- ✅ 资源加载错误（图片、脚本等）
- ✅ API 请求错误

### 2. **格式化错误输出**
所有错误会在控制台以统一格式输出，包含：
- 错误类型
- 错误信息
- 发生时间
- 组件名称（Vue 错误）
- 文件位置和行号
- 完整的调用栈

### 3. **可视化错误面板**（仅开发环境）
- 右下角显示错误徽章（显示错误数量）
- 点击徽章打开错误详情面板
- 支持查看所有错误历史
- 一键复制单个或全部错误

## 🚀 使用方法

### 方法 1: 控制台快捷命令（最快速）

在浏览器控制台输入以下命令：

```javascript
// 复制最新的错误（推荐）
__copyError()

// 查看所有错误历史
__errorHistory

// 清空错误历史
__clearErrors()
```

**工作流程**：
1. 在浏览器中触发错误
2. 打开控制台（F12）
3. 输入 `__copyError()` 并回车
4. 错误信息已复制到剪贴板
5. 直接在 Cursor 中粘贴（Ctrl+V）

### 方法 2: 可视化面板（更直观）

1. 当页面出现错误时，右下角会显示红色徽章
2. 点击徽章打开错误详情面板
3. 选择要复制的错误，点击"复制此错误"按钮
4. 在 Cursor 中粘贴

### 方法 3: 控制台格式化输出（传统方式）

1. 打开浏览器控制台（F12）
2. 查看格式化的错误信息（带有 🔴 标记）
3. 展开错误组查看详细信息
4. 手动复制需要的内容

## 📋 错误信息格式示例

```
========== 前端错误信息 ==========
时间: 2025-01-20 10:30:45
类型: vue
信息: Cannot read property 'name' of undefined
组件: ProductList
文件: ProductList.vue:45:12

调用栈:
Error: Cannot read property 'name' of undefined
    at Proxy._sfc_render (ProductList.vue:45:12)
    at renderComponentRoot (runtime-core.esm-bundler.js:...)
================================
```

## 💡 最佳实践

### 推荐工作流（按效率排序）

#### 🥇 最高效：控制台一键复制
```javascript
// 1. 触发错误
// 2. F12 打开控制台
// 3. 输入命令
__copyError()
// 4. 在 Cursor 中粘贴
```

**优点**：
- 最快速（2秒完成）
- 自动格式化
- 包含完整信息

#### 🥈 次高效：可视化面板
**适用场景**：
- 需要查看多个错误
- 需要对比不同错误
- 不熟悉控制台操作

#### 🥉 备选：截图
**适用场景**：
- 需要展示视觉问题
- 控制台信息不完整
- 需要同时展示多个信息源

**操作**：
1. `Win + Shift + S` 截图
2. 在 Cursor 中直接粘贴图片
3. Cursor 可以识别图片中的错误信息

## 🔧 配置说明

### 自动启用
错误捕获工具已自动集成到项目中，无需额外配置。

### 环境说明
- **开发环境**：
  - ✅ 显示可视化错误面板
  - ✅ 控制台快捷命令
  - ✅ 格式化错误输出
  
- **生产环境**：
  - ✅ 仍然捕获错误
  - ❌ 不显示可视化面板
  - ❌ 不暴露控制台命令
  - ✅ 显示友好的错误提示

## 🎨 面板功能说明

### 错误徽章
- **位置**：右下角
- **显示**：错误数量
- **动画**：脉冲效果提醒
- **点击**：打开/关闭面板

### 错误列表
- **颜色标记**：不同错误类型用不同颜色
  - 🟢 绿色：Vue 错误
  - 🔴 红色：JavaScript 错误
  - 🟠 橙色：Promise 错误
  - 🔵 蓝色：资源加载错误
  - 🟣 紫色：API 错误
  
- **可折叠调用栈**：点击展开/收起详细调用栈
- **单独复制**：每个错误可独立复制

### 操作按钮
- **复制最新错误**：复制列表顶部最新的错误
- **复制全部错误**：复制所有错误记录
- **清空**：清除错误历史记录

## 📝 向 Cursor AI 报告错误的最佳实践

### ✅ 好的错误报告
```
前端页面出现错误，错误信息如下：

========== 前端错误信息 ==========
时间: 2025-01-20 10:30:45
类型: vue
信息: Cannot read property 'name' of undefined
组件: ProductList
文件: ProductList.vue:45:12
...
================================

上下文：我在访问商品列表页面时，点击了"刷新"按钮后出现此错误。
```

### ❌ 不太好的错误报告
```
页面报错了，显示 undefined
```

### 📌 报告要点
1. **包含完整的错误信息**（使用 `__copyError()` 复制）
2. **说明操作步骤**（如何重现错误）
3. **提供上下文**（在哪个页面、点击了什么）

## 🛠️ 高级用法

### 查看错误历史
```javascript
// 查看所有错误
console.table(__errorHistory)

// 查看特定类型的错误
__errorHistory.filter(e => e.type === 'vue')

// 查看最近 5 个错误
__errorHistory.slice(0, 5)
```

### 编程方式使用
```typescript
// 在代码中手动记录错误
import { handleApiError } from '@/utils/error-handler';

try {
  await someApiCall();
} catch (error) {
  handleApiError(error, '/api/some-endpoint');
}
```

## 🔍 故障排查

### 问题：控制台没有 `__copyError` 命令
**原因**：可能是生产环境或工具未正确加载

**解决**：
1. 确认是开发环境（`npm run dev`）
2. 刷新页面
3. 查看控制台是否有 "🛠️ 错误捕获工具已启用" 提示

### 问题：看不到错误徽章
**原因**：可能还没有错误发生

**解决**：
1. 触发一个错误（访问某个页面）
2. 徽章会自动显示在右下角

### 问题：复制功能不工作
**原因**：浏览器可能阻止了剪贴板访问

**解决**：
1. 允许浏览器访问剪贴板
2. 或者手动复制控制台中的格式化输出

## 📚 相关文件

- `frontend/apps/web-antd/src/utils/error-handler.ts` - 错误处理核心逻辑
- `frontend/apps/web-antd/src/components/ErrorPanel.vue` - 可视化错误面板
- `frontend/apps/web-antd/src/bootstrap.ts` - 错误处理器初始化

## 🎓 总结

这套工具可以帮助您：
1. ⚡ **更快**：从触发错误到报告给 AI，只需 5 秒
2. 📋 **更准**：自动格式化，包含完整的调用栈信息
3. 🎯 **更易**：一键复制，无需手动整理
4. 👀 **更直观**：可视化面板，清晰查看所有错误

---

**快速开始**：现在就试试！在控制台输入 `__copyError()` 😊


# 开发阶段运行操作说明

本文档旨在帮助初学者快速在本地搭建和运行项目的开发环境。

## 1. 环境准备 (Prerequisites)

在开始之前，请确保你的电脑上安装了以下软件：

* **Node.js**: 版本需 **v20** 或更高。
  * [下载地址](https://nodejs.org/)
  * 用于运行前端代码。
* **pnpm**: 版本需 **9** 或更高。
  * 安装命令: `npm install -g pnpm` (需先安装 Node.js)
  * 前端包管理工具，比 npm 更快更节省空间。
* **Docker Desktop**: (推荐)
  * [下载地址](https://www.docker.com/products/docker-desktop/)
  * 用于一键运行后端及其依赖（Redis等），避免繁琐的本地环境配置。
* **Git**:
  * [下载地址](https://git-scm.com/)
  * 用于下载代码。

---

## 2. 获取代码

打开终端 (Terminal) 或 命令提示符 (CMD/PowerShell)，执行以下命令下载项目：

```bash
# 克隆项目到本地
git clone <项目仓库地址>

# 进入项目根目录
cd is-vue-admin
```

---

## 3. 运行后端程序 (Backend)

后端负责处理数据和业务逻辑。我们推荐使用 **Docker** 方式运行，因为它最简单且环境统一。

### 方式一：使用 Docker (强烈推荐)

确保 **Docker Desktop** 已经启动。

1. **回到项目根目录** (`is-vue-admin/`)。
2. **启动服务**:

```bash
 -d 表示在后台运行，不会占用当前终端窗口
# --build 表示如果有代码变动，重新构建镜像
docker compose up --build -d
```

3. **查看运行状态**:

```bash
# 查看容器列表，确保状态为 Up
docker compose ps
```

> **成功标志**:
>
> * 访问浏览器: `http://localhost:5000/docs`
> * 如果能看到 API 文档页面 (Swagger UI)，说明后端启动成功。

4. **停止服务** (开发结束时):

```bash
docker compose down
```

### 方式二：本地 Python 运行 (备选)

如果你不熟悉 Docker，也可以直接在本地运行 Python，但需要手动配置环境。

1. **安装 Python 3.10+**。
2. **创建虚拟环境**:
   ```bash
   cd backend
   python -m venv venv
   # 激活虚拟环境 (Windows)
   venv\Scripts\activate
   # 激活虚拟环境 (Mac/Linux)
   # source venv/bin/activate
   ```
3. **安装依赖**:
   ```bash
   pip install -r requirements.txt
   ```
4. **配置环境变量**:
   * 确保根目录下的 `env_config` 文件存在。
   * 你需要手动安装 Redis 并在本地启动，或者修改配置连接到远程 Redis。
5. **运行**:
   ```bash
   flask run --debug
   ```

---

## 4. 运行前端程序 (Frontend)

前端是用户看到的界面。

1. **进入前端目录**:

```bash
# 假设你当前在项目根目录
cd frontend
```

2. **安装依赖** (首次运行或依赖变更时需要):

```bash
# 下载并安装所有需要的包
pnpm install
```

3. **启动开发服务器**:

```bash
# 启动项目
pnpm dev
```

> **注意**: 启动可能需要几十秒，请耐心等待。

4. **访问项目**:
   * 终端会出现 `Local: http://localhost:xxxx` (通常是 5555 或 5173)。
   * 按住 `Ctrl` 点击链接，或复制到浏览器打开。

---

## 5. 常见问题 (FAQ)

### Q: 端口被占用 (Port already in use)

* **后端**: 默认使用 `5000` 端口。如果被占用，请关闭占用端口的程序，或者修改 `docker-compose.yml` 中的端口映射 (例如 `"5001:5000"`)。
* **前端**: Vite 会自动寻找下一个可用端口，通常不需要手动处理。

### Q: 数据库连接失败

* 项目默认配置连接的是阿里云远程开发数据库。
* 请确保你的电脑 **联网** 且网络环境允许访问外网数据库 (端口 5432)。
* 检查 `env_config` 文件中的 `DATABASE_URL` 是否正确。

### Q: 前端依赖安装失败

* 确保 Node.js 版本 >= 20。
* 尝试删除 `node_modules` 文件夹和 `pnpm-lock.yaml` 文件，然后重新运行 `pnpm install`。

### Q: 修改了后端代码没生效？

* **Docker 模式**: 保存代码后，Flask 会自动热重载。如果涉及 `requirements.txt` 变更，需要运行 `docker compose up --build -d`。
* **本地模式**: 保存代码后通常会自动重启，留意终端日志。

---

## 6. 快速参考清单

| 服务           | 目录           | 启动命令                 | 访问地址                                                   |
| :------------- | :------------- | :----------------------- | :--------------------------------------------------------- |
| **后端** | `/` (根目录) | `docker compose up -d` | [http://localhost:5000/docs](http://localhost:5000/docs)      |
| **前端** | `/frontend`  | `pnpm dev`             | [http://localhost:5555](http://localhost:5555) (端口可能变化) |

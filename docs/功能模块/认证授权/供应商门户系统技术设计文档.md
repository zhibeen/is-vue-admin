# ä¾›åº”å•†é—¨æˆ·ç³»ç»ŸæŠ€æœ¯è®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ç‰ˆæœ¬
- **ç‰ˆæœ¬**: 1.0
- **æ—¥æœŸ**: 2025å¹´12æœˆ18æ—¥
- **ä½œè€…**: æŠ€æœ¯æ¶æ„å›¢é˜Ÿ
- **çŠ¶æ€**: å¾…è¯„å®¡
- **ä¿®è®¢è®°å½•**: 
  - v1.0: åˆå§‹è®¾è®¡æ–¹æ¡ˆï¼ˆå¤šç”¨æˆ·ç±»å‹è®¤è¯ä½“ç³»ã€ä¾›åº”å•†é—¨æˆ·æ¶æ„ï¼‰

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ä¸šåŠ¡èƒŒæ™¯

åœ¨è·¨å¢ƒç”µå•†ä¾›åº”é“¾ç®¡ç†ä¸­ï¼Œä¾›åº”å•†æ˜¯å…³é”®çš„ä¸šåŠ¡åˆä½œä¼™ä¼´ã€‚å½“å‰ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹ç—›ç‚¹ï¼š

#### ç—›ç‚¹åˆ†æ

| åœºæ™¯ | å½“å‰åšæ³• | é—®é¢˜ |
|------|---------|------|
| **å‘è´§æ•°é‡æ ¸å¯¹** | ä¾›åº”å•†ç”µè¯/å¾®ä¿¡ç¡®è®¤ | æ•ˆç‡ä½ã€æ˜“é—æ¼ã€æ— è®°å½• |
| **å¼€ç¥¨ä¿¡æ¯ç¡®è®¤** | é‚®ä»¶æ¥å›æ²Ÿé€š | å‘¨æœŸé•¿ã€ä¿¡æ¯æ˜“é”™ã€æ— æ³•è¿½æº¯ |
| **å¯¹è´¦ç»“ç®—** | Excel è¡¨æ ¼æ‰‹å·¥æ ¸å¯¹ | è€—æ—¶ã€æ˜“å‡ºé”™ã€æ— æ³•å¹¶è¡Œå¤„ç† |
| **å‘ç¥¨ä¸Šä¼ ** | å¿«é€’å¯„é€çº¸è´¨ä»¶ | ç‰©æµæˆæœ¬é«˜ã€å½’æ¡£æ…¢ |
| **å‘è´§çŠ¶æ€æŸ¥è¯¢** | é‡‡è´­å‘˜æ‰‹åŠ¨é€šçŸ¥ | ä¾›åº”å•†æ— æ³•ä¸»åŠ¨è·å–ä¿¡æ¯ |

#### ä¸šåŠ¡ä»·å€¼

é€šè¿‡å»ºè®¾ä¾›åº”å•†é—¨æˆ·ç³»ç»Ÿï¼Œå®ç°ï¼š

1. âœ… **ä¸šåŠ¡è‡ªåŠ©åŒ–**ï¼šä¾›åº”å•†è‡ªä¸»æŸ¥çœ‹å‘è´§å•ã€ä¸Šä¼ å‘ç¥¨ã€ç¡®è®¤å¼€ç¥¨ä¿¡æ¯
2. âœ… **æµç¨‹æ•°å­—åŒ–**ï¼šæ‰€æœ‰æ“ä½œç•™ç—•ï¼Œæ”¯æŒå®¡è®¡å’Œè¿½æº¯
3. âœ… **æ•ˆç‡æå‡**ï¼šè´¢åŠ¡å¯¹è´¦æ•ˆç‡æå‡ 80%+ï¼Œå¼€ç¥¨å‘¨æœŸç¼©çŸ­ 50%
4. âœ… **æ•°æ®å‡†ç¡®æ€§**ï¼šç³»ç»Ÿè‡ªåŠ¨æ ¡éªŒï¼Œé¿å…äººå·¥æ ¸å¯¹é”™è¯¯
5. âœ… **åˆè§„æ€§å¢å¼º**ï¼šæ»¡è¶³ç¨åŠ¡ã€å®¡è®¡å¯¹ä¾›åº”å•†äº¤æ˜“çš„å¯è¿½æº¯è¦æ±‚

### 1.2 æ ¸å¿ƒéœ€æ±‚

#### åŠŸèƒ½æ€§éœ€æ±‚

1. **ä¾›åº”å•†ç”¨æˆ·ç®¡ç†**
   - ç‹¬ç«‹çš„ä¾›åº”å•†ç”¨æˆ·ä½“ç³»ï¼ˆåŒºåˆ«äºå†…éƒ¨å‘˜å·¥ï¼‰
   - æ”¯æŒä¸€ä¸ªä¾›åº”å•†å¤šä¸ªè´¦å·ï¼ˆé‡‡è´­å‘˜ã€è´¢åŠ¡ç­‰ï¼‰
   - è´¦å·æ¿€æ´»ã€å¯†ç é‡ç½®ã€æƒé™æ§åˆ¶

2. **å‘è´§å•ç®¡ç†**
   - æŸ¥çœ‹ä¸æœ¬ä¾›åº”å•†ç›¸å…³çš„å‘è´§å•åˆ—è¡¨
   - æŸ¥çœ‹å‘è´§å•è¯¦æƒ…ï¼ˆæ˜ç»†ã€ç‰©æµä¿¡æ¯ï¼‰
   - ç¡®è®¤å‘è´§æ•°é‡ã€ä¸Šä¼ ç‰©æµå•å·
   - å¯¼å‡ºå‘è´§å• PDF/Excel

3. **å¼€ç¥¨ç®¡ç†**
   - æŸ¥çœ‹å¾…å¼€ç¥¨çš„å¼€ç¥¨åˆåŒï¼ˆSupply Contractï¼‰
   - ä¸‹è½½å¼€ç¥¨åˆåŒ PDF
   - ä¸Šä¼ å‘ç¥¨æ‰«æä»¶ï¼ˆæ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼‰
   - æŸ¥çœ‹å¼€ç¥¨å†å²å’Œä»˜æ¬¾çŠ¶æ€

4. **å¯¹è´¦ç®¡ç†**
   - æœˆåº¦å¯¹è´¦å•æŸ¥çœ‹å’Œç¡®è®¤
   - åœ¨çº¿ç­¾å­—ç¡®è®¤
   - å¯¹è´¦å·®å¼‚æ ‡è®°å’Œå¤‡æ³¨

#### éåŠŸèƒ½æ€§éœ€æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| **å¯ç”¨æ€§** | 99.5% | å·¥ä½œæ—¥ 7x12h ä¿éšœ |
| **å“åº”æ—¶é—´** | < 2s | 90åˆ†ä½åˆ—è¡¨æŸ¥è¯¢ |
| **å¹¶å‘ç”¨æˆ·** | 200+ | æ”¯æŒ 200 ä¸ªä¾›åº”å•†åŒæ—¶åœ¨çº¿ |
| **æ•°æ®éš”ç¦»** | 100% | ä¾›åº”å•†åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ® |
| **æ“ä½œå®¡è®¡** | 100% | æ‰€æœ‰æ“ä½œå¿…é¡»å¯è¿½æº¯ |
| **ç§»åŠ¨é€‚é…** | å“åº”å¼ | æ”¯æŒæ‰‹æœºæµè§ˆå™¨è®¿é—® |

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph å‰ç«¯å±‚
        InternalUI[å†…éƒ¨å‘˜å·¥å‰ç«¯<br/>Vue3 + Vben Admin]
        SupplierUI[ä¾›åº”å•†å‰ç«¯<br/>å…±äº«å‰ç«¯æ¡†æ¶]
    end
    
    subgraph è®¤è¯å±‚
        Login[ç»Ÿä¸€ç™»å½•æ¥å£<br/>/api/v1/auth/login]
        JWT[JWT Token<br/>user_type å­—æ®µåŒºåˆ†]
    end
    
    subgraph APIç½‘å…³å±‚
        RouteGuard[è·¯ç”±å®ˆå«<br/>åŸºäº user_type]
        PermissionCheck[æƒé™éªŒè¯<br/>@permission_required]
    end
    
    subgraph ä¸šåŠ¡é€»è¾‘å±‚
        InternalAPI[å†…éƒ¨ API<br/>/api/v1/*]
        SupplierAPI[ä¾›åº”å•† API<br/>/api/v1/supplier/*]
    end
    
    subgraph æ•°æ®å±‚
        UserTable[(users è¡¨<br/>å†…éƒ¨å‘˜å·¥)]
        SupplierUserTable[(supplier_users è¡¨<br/>ä¾›åº”å•†ç”¨æˆ·)]
        SupplierTable[(sys_suppliers è¡¨<br/>ä¾›åº”å•†ä¸»æ•°æ®)]
        ShipmentTable[(shipment_orders è¡¨<br/>å‘è´§å•)]
        ContractTable[(scm_supply_contracts è¡¨<br/>å¼€ç¥¨åˆåŒ)]
    end
    
    InternalUI --> Login
    SupplierUI --> Login
    Login --> JWT
    
    JWT --> RouteGuard
    RouteGuard --> PermissionCheck
    
    PermissionCheck --> InternalAPI
    PermissionCheck --> SupplierAPI
    
    InternalAPI --> UserTable
    InternalAPI --> ShipmentTable
    InternalAPI --> ContractTable
    
    SupplierAPI --> SupplierUserTable
    SupplierAPI --> SupplierTable
    SupplierAPI --> ShipmentTable
    SupplierAPI --> ContractTable
```

### 2.2 æ¶æ„åˆ†å±‚è¯´æ˜

#### 2.2.1 è®¤è¯å±‚è®¾è®¡

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š
- âœ… ç»Ÿä¸€ç™»å½•å…¥å£ï¼Œåç«¯è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·ç±»å‹
- âœ… JWT Token åŒ…å« `user_type` å­—æ®µï¼ˆ`internal` / `supplier`ï¼‰
- âœ… ç”¨æˆ·åå…¨å±€å”¯ä¸€ï¼ˆè·¨ä¸¤å¼ ç”¨æˆ·è¡¨ï¼‰

**ä¸ºä»€ä¹ˆä¸é‡‡ç”¨ç‹¬ç«‹ç™»å½•é¡µé¢ï¼Ÿ**

| ç»´åº¦ | ç»Ÿä¸€ç™»å½• | ç‹¬ç«‹ç™»å½• |
|------|---------|---------|
| **ç”¨æˆ·ä½“éªŒ** | â­â­â­â­â­ ä¾›åº”å•†åªéœ€è®°ä½ä¸€ä¸ªURL | â­â­â­ éœ€è¦è®°ä½ä¸“å±URL |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­â­ åªæœ‰ä¸€ä¸ªç™»å½•é¡µé¢ | â­â­ ä¸¤å¥—ç™»å½•é€»è¾‘ |
| **æ‰©å±•æ€§** | â­â­â­â­â­ æœªæ¥å¢åŠ "å®¢æˆ·ç”¨æˆ·"æ— éœ€æ”¹åŠ¨ | â­â­ æ¯å¢åŠ ä¸€ç§ç”¨æˆ·å°±å¤šä¸€ä¸ªé¡µé¢ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ é›†ä¸­ç®¡æ§ï¼Œç»Ÿä¸€ç­–ç•¥ | â­â­â­â­ éœ€è¦åˆ†åˆ«ç»´æŠ¤å®‰å…¨ç­–ç•¥ |

#### 2.2.2 å‰ç«¯æ¶æ„è®¾è®¡

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š
- âœ… å¤ç”¨ç°æœ‰ Vben Admin æ¡†æ¶ï¼ˆè¡¨æ ¼ã€è¡¨å•ã€ä¸Šä¼ ç­‰ç»„ä»¶ï¼‰
- âœ… ä¾›åº”å•†ä½¿ç”¨ç®€åŒ–ç‰ˆ Layoutï¼ˆæ— ä¾§è¾¹æ ç³»ç»Ÿèœå•ï¼‰
- âœ… è·¯ç”±å®ˆå«æ ¹æ® `user_type` è‡ªåŠ¨è·³è½¬

**ä¸ºä»€ä¹ˆä¸å•ç‹¬æ„å»ºä¾›åº”å•†å‰ç«¯ï¼Ÿ**

| ç»´åº¦ | å…±äº«æ¡†æ¶ | ç‹¬ç«‹æ„å»º |
|------|---------|---------|
| **å¼€å‘æˆæœ¬** | â­â­â­â­â­ å¤ç”¨ 95% ä»£ç  | â­â­ éœ€è¦é‡æ–°æ­å»ºåŸºç¡€è®¾æ–½ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­â­ API å˜æ›´è‡ªåŠ¨åŒæ­¥ | â­â­ éœ€è¦åŒæ—¶ç»´æŠ¤ä¸¤å¥—å‰ç«¯ |
| **åŠŸèƒ½ä¸€è‡´æ€§** | â­â­â­â­â­ è‡ªåŠ¨ä¿æŒä¸€è‡´ | â­â­ å®¹æ˜“å‡ºç°åŠŸèƒ½å·®å¼‚ |
| **ä¸»é¢˜æ”¯æŒ** | â­â­â­â­â­ æ·±è‰²æ¨¡å¼/å›½é™…åŒ–è‡ªåŠ¨ç”Ÿæ•ˆ | â­â­ éœ€è¦é‡æ–°å®ç° |

---

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 3.1.1 ä¾›åº”å•†ç”¨æˆ·è¡¨ï¼ˆsupplier_usersï¼‰

```python
class SupplierUser(db.Model):
    """ä¾›åº”å•†ç”¨æˆ·è¡¨"""
    __tablename__ = "supplier_users"
    
    # ========== ä¸»é”®ä¸å…³è” ==========
    id: Mapped[int] = mapped_column(primary_key=True)
    supplier_id: Mapped[int] = mapped_column(
        ForeignKey("sys_suppliers.id"), 
        nullable=False, 
        comment='å…³è”ä¾›åº”å•†'
    )
    
    # ========== è´¦å·ä¿¡æ¯ ==========
    username: Mapped[str] = mapped_column(
        String(50), 
        unique=True, 
        index=True, 
        comment='ç”¨æˆ·åï¼ˆå…¨å±€å”¯ä¸€ï¼‰'
    )
    password_hash: Mapped[str] = mapped_column(String(256), comment='å¯†ç å“ˆå¸Œ')
    
    # ========== è”ç³»ä¿¡æ¯ ==========
    real_name: Mapped[str] = mapped_column(String(50), comment='çœŸå®å§“å')
    mobile: Mapped[Optional[str]] = mapped_column(String(20), comment='æ‰‹æœºå·ï¼ˆç”¨äºéªŒè¯ç ç™»å½•ï¼‰')
    email: Mapped[Optional[str]] = mapped_column(String(100), comment='é‚®ç®±')
    department: Mapped[Optional[str]] = mapped_column(String(50), comment='éƒ¨é—¨ï¼ˆå¦‚é‡‡è´­éƒ¨ã€è´¢åŠ¡éƒ¨ï¼‰')
    
    # ========== æƒé™æ§åˆ¶ ==========
    permissions: Mapped[List[str]] = mapped_column(
        JSONB, 
        default=['view_shipment', 'upload_invoice'],
        comment='æƒé™åˆ—è¡¨'
    )
    
    # ========== çŠ¶æ€ç®¡ç† ==========
    is_active: Mapped[bool] = mapped_column(Boolean, default=True, comment='è´¦å·æ˜¯å¦å¯ç”¨')
    last_login_at: Mapped[Optional[DateTime]] = mapped_column(DateTime, comment='æœ€åç™»å½•æ—¶é—´')
    last_login_ip: Mapped[Optional[str]] = mapped_column(String(50), comment='æœ€åç™»å½•IP')
    
    # ========== å®¡è®¡å­—æ®µ ==========
    created_at: Mapped[DateTime] = mapped_column(DateTime, server_default=func.now())
    updated_at: Mapped[Optional[DateTime]] = mapped_column(DateTime, onupdate=func.now())
    created_by: Mapped[Optional[int]] = mapped_column(Integer, comment='åˆ›å»ºäººï¼ˆå†…éƒ¨å‘˜å·¥IDï¼‰')
    
    # ========== å…³ç³» ==========
    supplier: Mapped["SysSupplier"] = relationship("SysSupplier", back_populates="users")
```

**è®¾è®¡è¦ç‚¹**ï¼š

1. **ç”¨æˆ·åå…¨å±€å”¯ä¸€æ€§**
   ```python
   # æ–¹å¼1ï¼šåº”ç”¨å±‚æ ¡éªŒï¼ˆæ¨èï¼‰
   def create_supplier_user(username):
       if User.query.filter_by(username=username).first():
           raise BusinessError('ç”¨æˆ·åå·²è¢«å ç”¨ï¼ˆå†…éƒ¨å‘˜å·¥ï¼‰')
       if SupplierUser.query.filter_by(username=username).first():
           raise BusinessError('ç”¨æˆ·åå·²è¢«å ç”¨ï¼ˆä¾›åº”å•†ç”¨æˆ·ï¼‰')
   
   # æ–¹å¼2ï¼šä½¿ç”¨å‰ç¼€è§„èŒƒï¼ˆå¯é€‰ï¼‰
   # ä¾›åº”å•†ç”¨æˆ·åå¼ºåˆ¶æ ¼å¼ï¼š{supplier_code}_{name}
   # ä¾‹å¦‚ï¼šhuawei_zhangsan, xiaomi_lisi
   ```

2. **æƒé™è®¾è®¡**
   ```python
   # ä¾›åº”å•†ç”¨æˆ·æƒé™åˆ—è¡¨ï¼ˆJSON æ•°ç»„ï¼‰
   permissions = [
       'view_shipment',           # æŸ¥çœ‹å‘è´§å•
       'confirm_shipment',        # ç¡®è®¤å‘è´§
       'upload_tracking',         # ä¸Šä¼ ç‰©æµå•å·
       'view_supply_contract',    # æŸ¥çœ‹å¼€ç¥¨åˆåŒ
       'upload_invoice',          # ä¸Šä¼ å‘ç¥¨
       'view_payment',            # æŸ¥çœ‹ä»˜æ¬¾çŠ¶æ€
       'view_statement',          # æŸ¥çœ‹å¯¹è´¦å•
       'confirm_statement',       # ç¡®è®¤å¯¹è´¦å•
   ]
   ```

#### 3.1.2 ä¾›åº”å•†ä¸»è¡¨æ‰©å±•

```python
class SysSupplier(db.Model):
    """ä¾›åº”å•†ä¸»è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œéœ€è¦æ‰©å±•ï¼‰"""
    __tablename__ = "sys_suppliers"
    
    # ... åŸæœ‰å­—æ®µ ...
    
    # ========== æ–°å¢å­—æ®µ ==========
    portal_enabled: Mapped[bool] = mapped_column(
        Boolean, 
        default=False, 
        comment='æ˜¯å¦å¯ç”¨ä¾›åº”å•†é—¨æˆ·'
    )
    portal_activated_at: Mapped[Optional[DateTime]] = mapped_column(
        DateTime, 
        comment='é—¨æˆ·æ¿€æ´»æ—¶é—´'
    )
    
    # ========== æ–°å¢å…³ç³» ==========
    users: Mapped[List["SupplierUser"]] = relationship(
        "SupplierUser", 
        back_populates="supplier",
        cascade="all, delete-orphan"
    )
```

#### 3.1.3 æ“ä½œæ—¥å¿—è¡¨ï¼ˆsupplier_operation_logsï¼‰

```python
class SupplierOperationLog(db.Model):
    """ä¾›åº”å•†æ“ä½œæ—¥å¿—è¡¨ï¼ˆç”¨äºå®¡è®¡ï¼‰"""
    __tablename__ = "supplier_operation_logs"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    
    # æ“ä½œä¸»ä½“
    supplier_user_id: Mapped[int] = mapped_column(ForeignKey("supplier_users.id"))
    supplier_id: Mapped[int] = mapped_column(ForeignKey("sys_suppliers.id"))
    
    # æ“ä½œå†…å®¹
    operation_type: Mapped[str] = mapped_column(String(50), comment='æ“ä½œç±»å‹')
    resource_type: Mapped[str] = mapped_column(String(50), comment='èµ„æºç±»å‹ï¼ˆå¦‚shipmentï¼‰')
    resource_id: Mapped[Optional[int]] = mapped_column(Integer, comment='èµ„æºID')
    
    # æ“ä½œè¯¦æƒ…
    action: Mapped[str] = mapped_column(String(20), comment='åŠ¨ä½œï¼ˆview/create/updateï¼‰')
    details: Mapped[Optional[dict]] = mapped_column(JSONB, comment='è¯¦ç»†æ•°æ®')
    
    # è¯·æ±‚ä¿¡æ¯
    ip_address: Mapped[str] = mapped_column(String(50))
    user_agent: Mapped[Optional[str]] = mapped_column(String(500))
    
    # æ—¶é—´æˆ³
    created_at: Mapped[DateTime] = mapped_column(DateTime, server_default=func.now())
```

### 3.2 æ•°æ®åº“è¿ç§»è„šæœ¬

```python
"""
æ·»åŠ ä¾›åº”å•†ç”¨æˆ·è¡¨å’Œç›¸å…³å­—æ®µ

Revision ID: 20251218_supplier_portal
Create Date: 2025-12-18
"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

def upgrade():
    # 1. åˆ›å»ºä¾›åº”å•†ç”¨æˆ·è¡¨
    op.create_table(
        'supplier_users',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('supplier_id', sa.Integer(), nullable=False),
        sa.Column('username', sa.String(50), nullable=False),
        sa.Column('password_hash', sa.String(256), nullable=False),
        sa.Column('real_name', sa.String(50), nullable=False),
        sa.Column('mobile', sa.String(20), nullable=True),
        sa.Column('email', sa.String(100), nullable=True),
        sa.Column('department', sa.String(50), nullable=True),
        sa.Column('permissions', postgresql.JSONB(), nullable=True),
        sa.Column('is_active', sa.Boolean(), default=True),
        sa.Column('last_login_at', sa.DateTime(), nullable=True),
        sa.Column('last_login_ip', sa.String(50), nullable=True),
        sa.Column('created_at', sa.DateTime(), server_default=sa.func.now()),
        sa.Column('updated_at', sa.DateTime(), onupdate=sa.func.now()),
        sa.Column('created_by', sa.Integer(), nullable=True),
        sa.PrimaryKeyConstraint('id'),
        sa.ForeignKeyConstraint(['supplier_id'], ['sys_suppliers.id']),
        sa.UniqueConstraint('username')
    )
    
    # 2. åˆ›å»ºç´¢å¼•
    op.create_index('ix_supplier_users_username', 'supplier_users', ['username'])
    op.create_index('ix_supplier_users_supplier_id', 'supplier_users', ['supplier_id'])
    
    # 3. æ‰©å±•ä¾›åº”å•†ä¸»è¡¨
    op.add_column('sys_suppliers', 
        sa.Column('portal_enabled', sa.Boolean(), default=False)
    )
    op.add_column('sys_suppliers', 
        sa.Column('portal_activated_at', sa.DateTime(), nullable=True)
    )
    
    # 4. åˆ›å»ºæ“ä½œæ—¥å¿—è¡¨
    op.create_table(
        'supplier_operation_logs',
        sa.Column('id', sa.Integer(), nullable=False),
        sa.Column('supplier_user_id', sa.Integer(), nullable=False),
        sa.Column('supplier_id', sa.Integer(), nullable=False),
        sa.Column('operation_type', sa.String(50), nullable=False),
        sa.Column('resource_type', sa.String(50), nullable=False),
        sa.Column('resource_id', sa.Integer(), nullable=True),
        sa.Column('action', sa.String(20), nullable=False),
        sa.Column('details', postgresql.JSONB(), nullable=True),
        sa.Column('ip_address', sa.String(50), nullable=False),
        sa.Column('user_agent', sa.String(500), nullable=True),
        sa.Column('created_at', sa.DateTime(), server_default=sa.func.now()),
        sa.PrimaryKeyConstraint('id'),
        sa.ForeignKeyConstraint(['supplier_user_id'], ['supplier_users.id']),
        sa.ForeignKeyConstraint(['supplier_id'], ['sys_suppliers.id'])
    )
    
    # 5. åˆ›å»ºç´¢å¼•ï¼ˆä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼‰
    op.create_index('ix_supplier_logs_supplier_id', 'supplier_operation_logs', ['supplier_id'])
    op.create_index('ix_supplier_logs_created_at', 'supplier_operation_logs', ['created_at'])

def downgrade():
    op.drop_table('supplier_operation_logs')
    op.drop_column('sys_suppliers', 'portal_activated_at')
    op.drop_column('sys_suppliers', 'portal_enabled')
    op.drop_table('supplier_users')
```

---

## 4. API è®¾è®¡

### 4.1 è®¤è¯æ¥å£

#### 4.1.1 ç»Ÿä¸€ç™»å½•æ¥å£ï¼ˆæ ¸å¿ƒè®¾è®¡ï¼‰

**æ¥å£è·¯å¾„**: `POST /api/v1/auth/login`

**è¯·æ±‚å‚æ•°**:
```json
{
  "username": "huawei_zhangsan",
  "password": "password123"
}
```

**åç«¯é€»è¾‘**:
```python
@auth_bp.post('/login')
@auth_bp.input(LoginInput, arg_name='data')
@auth_bp.output(TokenOutput)
def login(data):
    username = data['username']
    password = data['password']
    
    # ğŸ”‘ æ­¥éª¤1ï¼šå°è¯•ä»å†…éƒ¨ç”¨æˆ·è¡¨æŸ¥æ‰¾
    user = User.query.filter_by(username=username).first()
    if user and user.check_password(password):
        if not user.is_active:
            abort(403, 'Account is disabled')
        
        # ç”Ÿæˆå†…éƒ¨ç”¨æˆ· Token
        additional_claims = {
            "user_type": "internal",
            "roles": list(user.role_names),
            "permissions": list(user.permissions)
        }
        
        access_token = create_access_token(
            identity=str(user.id), 
            additional_claims=additional_claims
        )
        refresh_token = create_refresh_token(identity=str(user.id))
        
        return {
            'data': {
                'access_token': access_token,
                'refresh_token': refresh_token,
                'user_type': 'internal',
                'username': user.username,
                'nickname': user.nickname,
                'roles': list(user.role_names),
                'permissions': list(user.permissions)
            }
        }
    
    # ğŸ”‘ æ­¥éª¤2ï¼šå°è¯•ä»ä¾›åº”å•†ç”¨æˆ·è¡¨æŸ¥æ‰¾
    supplier_user = SupplierUser.query.filter_by(username=username).first()
    if supplier_user and supplier_user.check_password(password):
        if not supplier_user.is_active:
            abort(403, 'Account is disabled')
        
        # æ£€æŸ¥ä¾›åº”å•†æ˜¯å¦å¯ç”¨é—¨æˆ·
        if not supplier_user.supplier.portal_enabled:
            abort(403, 'Supplier portal is not enabled')
        
        # ç”Ÿæˆä¾›åº”å•†ç”¨æˆ· Token
        additional_claims = {
            "user_type": "supplier",
            "supplier_id": supplier_user.supplier_id,
            "supplier_code": supplier_user.supplier.code,
            "supplier_name": supplier_user.supplier.name,
            "permissions": supplier_user.permissions or []
        }
        
        access_token = create_access_token(
            identity=f"supplier_{supplier_user.id}",  # ğŸ”‘ åŠ å‰ç¼€é¿å…IDå†²çª
            additional_claims=additional_claims
        )
        refresh_token = create_refresh_token(identity=f"supplier_{supplier_user.id}")
        
        # ğŸ”‘ æ›´æ–°æœ€åç™»å½•ä¿¡æ¯
        supplier_user.last_login_at = datetime.utcnow()
        supplier_user.last_login_ip = request.remote_addr
        db.session.commit()
        
        # ğŸ”‘ è®°å½•ç™»å½•æ—¥å¿—
        log_supplier_operation(
            supplier_user_id=supplier_user.id,
            operation_type='login',
            action='login',
            details={'username': username}
        )
        
        return {
            'data': {
                'access_token': access_token,
                'refresh_token': refresh_token,
                'user_type': 'supplier',
                'username': supplier_user.username,
                'real_name': supplier_user.real_name,
                'supplier_id': supplier_user.supplier_id,
                'supplier_name': supplier_user.supplier.name,
                'permissions': supplier_user.permissions
            }
        }
    
    # ğŸ”‘ æ­¥éª¤3ï¼šéƒ½ä¸åŒ¹é…ï¼Œè¿”å›é”™è¯¯
    abort(401, 'Invalid username or password')
```

**å“åº”ç¤ºä¾‹ï¼ˆä¾›åº”å•†ç”¨æˆ·ï¼‰**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_type": "supplier",
    "username": "huawei_zhangsan",
    "real_name": "å¼ ä¸‰",
    "supplier_id": 5,
    "supplier_name": "æ·±åœ³åä¸ºç§‘æŠ€",
    "permissions": ["view_shipment", "upload_invoice"]
  }
}
```

**JWT Token Payloadï¼ˆä¾›åº”å•†ç”¨æˆ·ï¼‰**:
```json
{
  "identity": "supplier_123",
  "user_type": "supplier",
  "supplier_id": 5,
  "supplier_code": "HUAWEI",
  "supplier_name": "æ·±åœ³åä¸ºç§‘æŠ€",
  "permissions": ["view_shipment", "upload_invoice"],
  "exp": 1703001600
}
```

#### 4.1.2 Token éªŒè¯æ”¹é€ 

```python
# backend/app/security.py

def verify_token():
    """éªŒè¯ Token å¹¶åŠ è½½ç”¨æˆ·å¯¹è±¡"""
    try:
        verify_jwt_in_request()
        
        identity = get_jwt_identity()
        claims = get_jwt()
        user_type = claims.get('user_type')
        
        # ğŸ”‘ æ ¹æ®ç”¨æˆ·ç±»å‹åŠ è½½ä¸åŒçš„ç”¨æˆ·å¯¹è±¡
        if user_type == 'supplier':
            # æå–ä¾›åº”å•†ç”¨æˆ·IDï¼ˆå»æ‰ supplier_ å‰ç¼€ï¼‰
            supplier_user_id = int(identity.replace('supplier_', ''))
            user = SupplierUser.query.get(supplier_user_id)
            
            if not user or not user.is_active:
                return None
            
            # ğŸ”‘ æ£€æŸ¥ä¾›åº”å•†é—¨æˆ·æ˜¯å¦å¯ç”¨
            if not user.supplier.portal_enabled:
                return None
            
            return user
        else:
            # å†…éƒ¨ç”¨æˆ·
            user_id = int(identity)
            user = User.query.get(user_id)
            
            if not user or not user.is_active:
                return None
            
            return user
    
    except Exception as e:
        logger.error(f"Token verification failed: {str(e)}")
        return None

# æ³¨å†ŒéªŒè¯å‡½æ•°
auth.verify_token(verify_token)
```

### 4.2 ä¾›åº”å•†ä¸“å± API

#### 4.2.1 æˆ‘çš„å‘è´§å•åˆ—è¡¨

**æ¥å£è·¯å¾„**: `GET /api/v1/supplier/shipments`

**æƒé™è¦æ±‚**: `view_shipment`

**è¯·æ±‚å‚æ•°**:
```json
{
  "page": 1,
  "per_page": 20,
  "status": "shipped",
  "start_date": "2025-01-01",
  "end_date": "2025-12-31"
}
```

**åç«¯å®ç°**:
```python
@supplier_bp.route('/shipments')
@supplier_bp.auth_required(auth)
@supplier_bp.input(PaginationQuerySchema, location='query', arg_name='pagination')
@supplier_bp.output(make_pagination_schema(ShipmentOrderItemSchema))
def get_my_shipments(pagination):
    """è·å–æˆ‘çš„å‘è´§å•æ˜ç»†åˆ—è¡¨"""
    claims = get_jwt()
    
    # ğŸ”‘ éªŒè¯ç”¨æˆ·ç±»å‹
    if claims.get('user_type') != 'supplier':
        abort(403, 'Access denied')
    
    supplier_id = claims.get('supplier_id')
    
    # ğŸ”‘ æƒé™æ£€æŸ¥
    current_user = auth.current_user
    if 'view_shipment' not in current_user.permissions:
        abort(403, 'Permission denied')
    
    # ğŸ”‘ æ„å»ºæŸ¥è¯¢ï¼ˆåªæŸ¥è¯¢è¯¥ä¾›åº”å•†çš„æ•°æ®ï¼‰
    query = ShipmentOrderItem.query.filter_by(supplier_id=supplier_id)
    
    # çŠ¶æ€è¿‡æ»¤
    if pagination.get('status'):
        query = query.join(ShipmentOrder).filter(
            ShipmentOrder.status == pagination['status']
        )
    
    # æ—¥æœŸè¿‡æ»¤
    if pagination.get('start_date'):
        query = query.join(ShipmentOrder).filter(
            ShipmentOrder.actual_ship_date >= pagination['start_date']
        )
    
    # åˆ†é¡µ
    page = pagination['page']
    per_page = pagination['per_page']
    paginated = query.paginate(page=page, per_page=per_page)
    
    # ğŸ”‘ è®°å½•è®¿é—®æ—¥å¿—
    log_supplier_operation(
        supplier_user_id=current_user.id,
        operation_type='view',
        resource_type='shipment',
        action='list'
    )
    
    return {
        'data': {
            'items': paginated.items,
            'total': paginated.total,
            'page': page,
            'per_page': per_page
        }
    }
```

#### 4.2.2 å‘è´§å•è¯¦æƒ…

**æ¥å£è·¯å¾„**: `GET /api/v1/supplier/shipments/{item_id}`

**æƒé™è¦æ±‚**: `view_shipment`

**åç«¯å®ç°**:
```python
@supplier_bp.route('/shipments/<int:item_id>')
@supplier_bp.auth_required(auth)
@supplier_bp.output(ShipmentOrderItemSchema)
def get_shipment_detail(item_id: int):
    """è·å–å‘è´§å•æ˜ç»†è¯¦æƒ…"""
    claims = get_jwt()
    supplier_id = claims.get('supplier_id')
    
    # ğŸ”‘ æŸ¥è¯¢å¹¶éªŒè¯æƒé™
    item = ShipmentOrderItem.query.filter_by(
        id=item_id,
        supplier_id=supplier_id  # ğŸ”‘ ç¡®ä¿åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
    ).first_or_404()
    
    # è®°å½•è®¿é—®æ—¥å¿—
    log_supplier_operation(
        supplier_user_id=auth.current_user.id,
        operation_type='view',
        resource_type='shipment',
        resource_id=item_id,
        action='detail'
    )
    
    return {'data': item}
```

#### 4.2.3 ç¡®è®¤å‘è´§ï¼ˆä¸Šä¼ ç‰©æµå•å·ï¼‰

**æ¥å£è·¯å¾„**: `POST /api/v1/supplier/shipments/{item_id}/confirm`

**æƒé™è¦æ±‚**: `confirm_shipment`

**è¯·æ±‚å‚æ•°**:
```json
{
  "tracking_no": "SF1234567890",
  "confirmed_quantity": 1000,
  "notes": "å·²é€šè¿‡é¡ºä¸°å‘å‡º"
}
```

**åç«¯å®ç°**:
```python
@supplier_bp.route('/shipments/<int:item_id>/confirm')
@supplier_bp.auth_required(auth)
@supplier_bp.input(ShipmentConfirmSchema, arg_name='data')
@supplier_bp.output(ShipmentOrderItemSchema)
def confirm_shipment(item_id: int, data):
    """ä¾›åº”å•†ç¡®è®¤å‘è´§"""
    claims = get_jwt()
    supplier_id = claims.get('supplier_id')
    current_user = auth.current_user
    
    # æƒé™æ£€æŸ¥
    if 'confirm_shipment' not in current_user.permissions:
        abort(403, 'Permission denied')
    
    # æŸ¥è¯¢æ˜ç»†
    item = ShipmentOrderItem.query.filter_by(
        id=item_id,
        supplier_id=supplier_id
    ).first_or_404()
    
    # ğŸ”‘ ä¸šåŠ¡æ ¡éªŒï¼šæ•°é‡ä¸èƒ½è¶…è¿‡è®¢å•æ•°é‡
    if data['confirmed_quantity'] > item.quantity:
        raise BusinessError('ç¡®è®¤æ•°é‡ä¸èƒ½è¶…è¿‡è®¢å•æ•°é‡')
    
    # ğŸ”‘ æ›´æ–°æ•°æ®
    item.confirmed_quantity = data['confirmed_quantity']
    item.supplier_tracking_no = data.get('tracking_no')
    item.supplier_confirm_notes = data.get('notes')
    item.supplier_confirmed_at = datetime.utcnow()
    item.supplier_confirmed_by = current_user.id
    
    db.session.commit()
    
    # è®°å½•æ“ä½œæ—¥å¿—
    log_supplier_operation(
        supplier_user_id=current_user.id,
        operation_type='update',
        resource_type='shipment',
        resource_id=item_id,
        action='confirm',
        details=data
    )
    
    return {'data': item}
```

#### 4.2.4 æˆ‘çš„å¼€ç¥¨åˆåŒåˆ—è¡¨

**æ¥å£è·¯å¾„**: `GET /api/v1/supplier/supply-contracts`

**åç«¯å®ç°**:
```python
@supplier_bp.route('/supply-contracts')
@supplier_bp.auth_required(auth)
@supplier_bp.input(PaginationQuerySchema, location='query', arg_name='pagination')
@supplier_bp.output(make_pagination_schema(SupplyContractSchema))
def get_my_supply_contracts(pagination):
    """è·å–æˆ‘çš„å¼€ç¥¨åˆåŒåˆ—è¡¨"""
    claims = get_jwt()
    supplier_id = claims.get('supplier_id')
    
    # ğŸ”‘ åªæŸ¥è¯¢è¯¥ä¾›åº”å•†çš„å¼€ç¥¨åˆåŒ
    query = SupplyContract.query.filter_by(supplier_id=supplier_id)
    
    # çŠ¶æ€è¿‡æ»¤
    if pagination.get('invoice_status'):
        query = query.filter_by(invoice_status=pagination['invoice_status'])
    
    # åˆ†é¡µ
    paginated = query.paginate(
        page=pagination['page'],
        per_page=pagination['per_page']
    )
    
    return {
        'data': {
            'items': paginated.items,
            'total': paginated.total
        }
    }
```

#### 4.2.5 ä¸Šä¼ å‘ç¥¨

**æ¥å£è·¯å¾„**: `POST /api/v1/supplier/supply-contracts/{contract_id}/upload-invoice`

**æƒé™è¦æ±‚**: `upload_invoice`

**è¯·æ±‚å‚æ•°**: `multipart/form-data`
- `file`: å‘ç¥¨æ‰«æä»¶ï¼ˆPDF/JPG/PNGï¼‰
- `invoice_no`: å‘ç¥¨å·ç 
- `invoice_code`: å‘ç¥¨ä»£ç 
- `invoice_date`: å¼€ç¥¨æ—¥æœŸ

**åç«¯å®ç°**:
```python
@supplier_bp.route('/supply-contracts/<int:contract_id>/upload-invoice')
@supplier_bp.auth_required(auth)
@supplier_bp.input(InvoiceUploadSchema, location='form_and_files', arg_name='data')
@supplier_bp.output(SupplyContractSchema)
def upload_invoice(contract_id: int, data):
    """ä¸Šä¼ å‘ç¥¨"""
    claims = get_jwt()
    supplier_id = claims.get('supplier_id')
    current_user = auth.current_user
    
    # æƒé™æ£€æŸ¥
    if 'upload_invoice' not in current_user.permissions:
        abort(403, 'Permission denied')
    
    # æŸ¥è¯¢åˆåŒ
    contract = SupplyContract.query.filter_by(
        id=contract_id,
        supplier_id=supplier_id
    ).first_or_404()
    
    # ğŸ”‘ ä¸šåŠ¡æ ¡éªŒï¼šåˆåŒçŠ¶æ€å¿…é¡»ä¸º"å¾…å¼€ç¥¨"
    if contract.invoice_status != 'pending':
        raise BusinessError('è¯¥åˆåŒä¸åœ¨å¾…å¼€ç¥¨çŠ¶æ€')
    
    # ğŸ”‘ ä¸Šä¼ æ–‡ä»¶åˆ° NAS
    file_obj = data['file']
    file_path = upload_invoice_file(
        file_obj=file_obj,
        supplier_id=supplier_id,
        contract_id=contract_id
    )
    
    # ğŸ”‘ åˆ›å»ºå‘ç¥¨è®°å½•
    invoice = SupplierTaxInvoice(
        invoice_no=data['invoice_no'],
        invoice_code=data['invoice_code'],
        invoice_date=data['invoice_date'],
        supply_contract_id=contract_id,
        supplier_id=supplier_id,
        amount=contract.amount,
        tax_amount=contract.tax_amount,
        total_amount=contract.total_amount,
        file_path=file_path,
        uploaded_by=current_user.id,
        uploaded_at=datetime.utcnow()
    )
    
    db.session.add(invoice)
    
    # ğŸ”‘ æ›´æ–°åˆåŒçŠ¶æ€
    contract.invoice_status = 'uploaded'
    contract.invoice_uploaded_at = datetime.utcnow()
    
    db.session.commit()
    
    # è®°å½•æ“ä½œæ—¥å¿—
    log_supplier_operation(
        supplier_user_id=current_user.id,
        operation_type='create',
        resource_type='invoice',
        resource_id=invoice.id,
        action='upload',
        details={
            'contract_id': contract_id,
            'invoice_no': data['invoice_no']
        }
    )
    
    return {'data': contract}
```

---

## 5. å‰ç«¯å®ç°

### 5.1 è·¯ç”±é…ç½®

```typescript
// frontend/apps/web-antd/src/router/routes/modules/supplier.ts

import type { RouteRecordRaw } from 'vue-router';
import { SupplierLayout } from '#/layouts';
import { $t } from '#/locales';

const routes: RouteRecordRaw[] = [
  {
    component: SupplierLayout,  // ğŸ”‘ ä¾›åº”å•†ä¸“å±å¸ƒå±€
    meta: {
      requiresAuth: true,
      requiresUserType: 'supplier',  // ğŸ”‘ åªæœ‰ä¾›åº”å•†å¯è®¿é—®
    },
    name: 'SupplierPortal',
    path: '/supplier',
    redirect: '/supplier/shipments',
    children: [
      {
        name: 'SupplierShipments',
        path: 'shipments',
        component: () => import('#/views/supplier/shipments/index.vue'),
        meta: {
          icon: 'lucide:package',
          title: $t('æˆ‘çš„å‘è´§å•'),
        },
      },
      {
        name: 'SupplierShipmentDetail',
        path: 'shipments/:id',
        component: () => import('#/views/supplier/shipments/detail.vue'),
        meta: {
          hideInMenu: true,
          title: $t('å‘è´§å•è¯¦æƒ…'),
          activePath: '/supplier/shipments',
        },
      },
      {
        name: 'SupplierContracts',
        path: 'contracts',
        component: () => import('#/views/supplier/contracts/index.vue'),
        meta: {
          icon: 'lucide:file-text',
          title: $t('å¼€ç¥¨ç®¡ç†'),
        },
      },
      {
        name: 'SupplierStatements',
        path: 'statements',
        component: () => import('#/views/supplier/statements/index.vue'),
        meta: {
          icon: 'lucide:calculator',
          title: $t('å¯¹è´¦å•'),
        },
      },
    ],
  },
];

export default routes;
```

### 5.2 è·¯ç”±å®ˆå«ï¼ˆå…³é”®å®ç°ï¼‰

```typescript
// frontend/apps/web-antd/src/router/guard.ts

import { useAuthStore } from '#/store';

router.beforeEach(async (to, from, next) => {
  const authStore = useAuthStore();
  
  // å¦‚æœéœ€è¦ç™»å½•ä¸”æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
  if (to.meta.requiresAuth && !authStore.isAuthenticated) {
    return next({
      path: '/auth/login',
      query: { redirect: to.fullPath },
    });
  }
  
  // ğŸ”‘ å¦‚æœå·²ç™»å½•ï¼Œæ ¹æ®ç”¨æˆ·ç±»å‹è¿›è¡Œè·¯ç”±æ§åˆ¶
  if (authStore.isAuthenticated) {
    const userType = authStore.userInfo?.user_type;
    
    // ğŸ”‘ ä¾›åº”å•†ç”¨æˆ·ï¼šåªèƒ½è®¿é—®ä¾›åº”å•†è·¯ç”±
    if (userType === 'supplier') {
      if (!to.path.startsWith('/supplier')) {
        return next('/supplier/shipments');
      }
    }
    
    // ğŸ”‘ å†…éƒ¨ç”¨æˆ·ï¼šä¸èƒ½è®¿é—®ä¾›åº”å•†è·¯ç”±
    if (userType === 'internal') {
      if (to.path.startsWith('/supplier')) {
        return next('/');
      }
    }
  }
  
  next();
});
```

### 5.3 ä¾›åº”å•†ä¸“å±å¸ƒå±€

```vue
<!-- frontend/apps/web-antd/src/layouts/SupplierLayout.vue -->

<template>
  <div class="supplier-layout min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="sticky top-0 z-50 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div class="container mx-auto px-4 h-16 flex items-center justify-between">
        <!-- Logo -->
        <div class="flex items-center gap-4">
          <img src="/logo.svg" alt="Logo" class="h-8" />
          <span class="text-lg font-semibold">{{ supplierName }}</span>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="hidden md:flex items-center gap-6">
          <router-link
            v-for="item in menuItems"
            :key="item.path"
            :to="item.path"
            class="text-gray-600 hover:text-primary dark:text-gray-300"
            active-class="text-primary font-semibold"
          >
            <Icon :icon="item.icon" class="inline-block mr-1" />
            {{ item.title }}
          </router-link>
        </nav>
        
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="flex items-center gap-4">
          <a-dropdown>
            <div class="flex items-center gap-2 cursor-pointer">
              <a-avatar :size="32">
                {{ userInitial }}
              </a-avatar>
              <span class="text-sm">{{ realName }}</span>
            </div>
            <template #overlay>
              <a-menu>
                <a-menu-item @click="handlePasswordChange">
                  <Icon icon="lucide:key" class="mr-2" />
                  ä¿®æ”¹å¯†ç 
                </a-menu-item>
                <a-menu-divider />
                <a-menu-item @click="handleLogout">
                  <Icon icon="lucide:log-out" class="mr-2" />
                  é€€å‡ºç™»å½•
                </a-menu-item>
              </a-menu>
            </template>
          </a-dropdown>
        </div>
      </div>
    </header>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-6">
      <RouterView />
    </main>
    
    <!-- é¡µè„š -->
    <footer class="mt-auto py-6 text-center text-gray-500 text-sm">
      Â© 2025 Your Company. All rights reserved.
    </footer>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useAuthStore } from '#/store';
import { useRouter } from 'vue-router';

const authStore = useAuthStore();
const router = useRouter();

const supplierName = computed(() => authStore.userInfo?.supplier_name);
const realName = computed(() => authStore.userInfo?.real_name);
const userInitial = computed(() => realName.value?.charAt(0) || 'U');

const menuItems = [
  { path: '/supplier/shipments', title: 'æˆ‘çš„å‘è´§å•', icon: 'lucide:package' },
  { path: '/supplier/contracts', title: 'å¼€ç¥¨ç®¡ç†', icon: 'lucide:file-text' },
  { path: '/supplier/statements', title: 'å¯¹è´¦å•', icon: 'lucide:calculator' },
];

async function handleLogout() {
  await authStore.logout();
  router.push('/auth/login');
}

function handlePasswordChange() {
  // TODO: å®ç°å¯†ç ä¿®æ”¹
}
</script>
```

### 5.4 å‘è´§å•åˆ—è¡¨é¡µé¢

```vue
<!-- frontend/apps/web-antd/src/views/supplier/shipments/index.vue -->

<script setup lang="ts">
import { useVbenVxeGrid, type VxeGridProps } from '#/adapter/vxe-table';
import { getMyShipments } from '#/api/supplier';
import { onMounted, ref } from 'vue';

// Grid é…ç½®
const gridOptions: VxeGridProps = {
  columns: [
    { field: 'shipment_no', title: 'å‘è´§å•å·', width: 150 },
    { field: 'sku', title: 'SKU', width: 120 },
    { field: 'product_name', title: 'å•†å“åç§°', minWidth: 200 },
    { field: 'quantity', title: 'è®¢å•æ•°é‡', width: 100 },
    { 
      field: 'confirmed_quantity', 
      title: 'å·²ç¡®è®¤æ•°é‡', 
      width: 120,
      cellRender: {
        name: '$default',
        setup: ({ row }) => {
          return row.confirmed_quantity || '-';
        }
      }
    },
    { field: 'unit', title: 'å•ä½', width: 80 },
    { 
      field: 'status', 
      title: 'çŠ¶æ€', 
      width: 100,
      cellRender: {
        name: 'ATag',
        props: (params) => {
          const statusMap = {
            'draft': { color: 'default', text: 'è‰ç¨¿' },
            'confirmed': { color: 'processing', text: 'å·²ç¡®è®¤' },
            'shipped': { color: 'success', text: 'å·²å‘è´§' },
          };
          const status = statusMap[params.row.status] || {};
          return { color: status.color, children: status.text };
        }
      }
    },
    {
      title: 'æ“ä½œ',
      width: 150,
      slots: { default: 'action' },
    },
  ],
  data: [],
  pagerConfig: { enabled: true },
  toolbarConfig: {
    refresh: { code: 'query' },
  },
};

// åˆå§‹åŒ– Grid
const [Grid, gridApi] = useVbenVxeGrid({
  gridOptions,
  gridEvents: {
    toolbarToolClick: (params) => {
      if (params.code === 'query') loadData();
    }
  }
});

// æ•°æ®åŠ è½½
async function loadData() {
  try {
    gridApi.setLoading(true);
    const res = await getMyShipments({
      page: 1,
      per_page: 20
    });
    gridApi.setGridOptions({ data: res.data.items });
  } catch (e) {
    console.error(e);
  } finally {
    gridApi.setLoading(false);
  }
}

// ç¡®è®¤å‘è´§
function handleConfirm(row: any) {
  // TODO: æ‰“å¼€ç¡®è®¤å¯¹è¯æ¡†
}

onMounted(() => {
  loadData();
});
</script>

<template>
  <div class="supplier-shipments">
    <a-card title="æˆ‘çš„å‘è´§å•" :bordered="false">
      <Grid>
        <template #action="{ row }">
          <a-space>
            <a-button type="link" size="small">è¯¦æƒ…</a-button>
            <a-button 
              v-if="row.status === 'confirmed'" 
              type="link" 
              size="small"
              @click="handleConfirm(row)"
            >
              ç¡®è®¤å‘è´§
            </a-button>
          </a-space>
        </template>
      </Grid>
    </a-card>
  </div>
</template>
```

---

## 6. å®‰å…¨æ€§è®¾è®¡

### 6.1 å®‰å…¨å¨èƒåˆ†æ

| å¨èƒç±»å‹ | é£é™©ç­‰çº§ | ç¼“è§£æªæ–½ |
|---------|---------|---------|
| **è¶Šæƒè®¿é—®** | ğŸ”´ é«˜ | åç«¯å¼ºåˆ¶æ•°æ®éš”ç¦»ï¼ˆsupplier_id è¿‡æ»¤ï¼‰ |
| **Token æ³„éœ²** | ğŸ”´ é«˜ | çŸ­è¿‡æœŸæ—¶é—´ï¼ˆ2hï¼‰ + Refresh Token æœºåˆ¶ |
| **æš´åŠ›ç ´è§£** | ğŸŸ¡ ä¸­ | ç™»å½•å¤±è´¥é™åˆ¶ï¼ˆ5æ¬¡/15åˆ†é’Ÿï¼‰ |
| **SQL æ³¨å…¥** | ğŸŸ¢ ä½ | ORM è‡ªåŠ¨å‚æ•°åŒ–æŸ¥è¯¢ |
| **æ–‡ä»¶ä¸Šä¼ æ¼æ´** | ğŸŸ¡ ä¸­ | æ–‡ä»¶ç±»å‹ç™½åå• + å¤§å°é™åˆ¶ + ç—…æ¯’æ‰«æ |
| **XSS æ”»å‡»** | ğŸŸ¢ ä½ | å‰ç«¯è‡ªåŠ¨è½¬ä¹‰ + CSP ç­–ç•¥ |

### 6.2 æ•°æ®éš”ç¦»æœºåˆ¶ï¼ˆæ ¸å¿ƒå®‰å…¨ï¼‰

**åŸåˆ™**ï¼šä¾›åº”å•†åªèƒ½è®¿é—®ä¸è‡ªå·±ç›¸å…³çš„æ•°æ®

```python
# ğŸ”‘ è£…é¥°å™¨ï¼šè‡ªåŠ¨æ³¨å…¥ä¾›åº”å•† ID è¿‡æ»¤
def supplier_data_filter(model_class, foreign_key='supplier_id'):
    """è£…é¥°å™¨ï¼šè‡ªåŠ¨è¿‡æ»¤ä¾›åº”å•†æ•°æ®"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            claims = get_jwt()
            
            # åªå¯¹ä¾›åº”å•†ç”¨æˆ·ç”Ÿæ•ˆ
            if claims.get('user_type') != 'supplier':
                return func(*args, **kwargs)
            
            supplier_id = claims.get('supplier_id')
            
            # æ³¨å…¥è¿‡æ»¤æ¡ä»¶
            kwargs['supplier_id_filter'] = supplier_id
            
            return func(*args, **kwargs)
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@supplier_bp.route('/shipments')
@supplier_bp.auth_required(auth)
@supplier_data_filter(ShipmentOrderItem, 'supplier_id')
def get_my_shipments(supplier_id_filter=None):
    query = ShipmentOrderItem.query
    
    # ğŸ”‘ è‡ªåŠ¨æ³¨å…¥è¿‡æ»¤æ¡ä»¶
    if supplier_id_filter:
        query = query.filter_by(supplier_id=supplier_id_filter)
    
    return {'data': query.all()}
```

### 6.3 æ“ä½œå®¡è®¡

**æ‰€æœ‰ä¾›åº”å•†æ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—**ï¼š

```python
def log_supplier_operation(
    supplier_user_id: int,
    operation_type: str,
    resource_type: str = None,
    resource_id: int = None,
    action: str = None,
    details: dict = None
):
    """è®°å½•ä¾›åº”å•†æ“ä½œæ—¥å¿—"""
    from flask import request
    
    log = SupplierOperationLog(
        supplier_user_id=supplier_user_id,
        supplier_id=auth.current_user.supplier_id,
        operation_type=operation_type,
        resource_type=resource_type,
        resource_id=resource_id,
        action=action,
        details=details,
        ip_address=request.remote_addr,
        user_agent=request.headers.get('User-Agent')
    )
    
    db.session.add(log)
    db.session.commit()
```

### 6.4 æ–‡ä»¶ä¸Šä¼ å®‰å…¨

```python
ALLOWED_EXTENSIONS = {'pdf', 'jpg', 'jpeg', 'png'}
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

def validate_upload_file(file_obj: FileStorage):
    """éªŒè¯ä¸Šä¼ æ–‡ä»¶"""
    # 1. æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
    filename = secure_filename(file_obj.filename)
    ext = filename.rsplit('.', 1)[1].lower()
    
    if ext not in ALLOWED_EXTENSIONS:
        raise BusinessError(f'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š{ext}')
    
    # 2. æ£€æŸ¥æ–‡ä»¶å¤§å°
    file_obj.seek(0, 2)  # ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾
    size = file_obj.tell()
    file_obj.seek(0)  # é‡ç½®åˆ°æ–‡ä»¶å¼€å¤´
    
    if size > MAX_FILE_SIZE:
        raise BusinessError('æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ10MBï¼‰')
    
    # 3. æ£€æŸ¥ MIME ç±»å‹ï¼ˆé˜²æ­¢ä¼ªé€ æ‰©å±•åï¼‰
    mime_type = magic.from_buffer(file_obj.read(1024), mime=True)
    file_obj.seek(0)
    
    allowed_mimes = {
        'application/pdf',
        'image/jpeg',
        'image/png'
    }
    
    if mime_type not in allowed_mimes:
        raise BusinessError(f'æ–‡ä»¶å†…å®¹ç±»å‹ä¸åŒ¹é…ï¼š{mime_type}')
    
    return filename, ext
```

---

## 7. å®æ–½è®¡åˆ’

### 7.1 å¼€å‘é˜¶æ®µ

#### Phase 1: åŸºç¡€æ¶æ„ï¼ˆ1å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆ`supplier_users`, `supplier_operation_logs`ï¼‰
- [ ] ä¿®æ”¹ç™»å½•æ¥å£ï¼ˆæ”¯æŒå¤šç”¨æˆ·ç±»å‹ï¼‰
- [ ] ä¿®æ”¹ JWT éªŒè¯é€»è¾‘ï¼ˆ`verify_token`ï¼‰
- [ ] å¼€å‘ä¾›åº”å•†ç”¨æˆ·ç®¡ç† APIï¼ˆCRUDï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ä¾›åº”å•†ç”¨æˆ·å¯ä»¥æˆåŠŸç™»å½•
- âœ… Token åŒ…å«æ­£ç¡®çš„ `user_type` å’Œ `supplier_id`
- âœ… å†…éƒ¨ç”¨æˆ·å’Œä¾›åº”å•†ç”¨æˆ·äº’ä¸å¹²æ‰°

#### Phase 2: ä¾›åº”å•† APIï¼ˆ2å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å‘è´§å•åˆ—è¡¨/è¯¦æƒ… API
- [ ] å‘è´§ç¡®è®¤ API
- [ ] å¼€ç¥¨åˆåŒåˆ—è¡¨ API
- [ ] å‘ç¥¨ä¸Šä¼  API
- [ ] å¯¹è´¦å•æŸ¥çœ‹/ç¡®è®¤ API
- [ ] æ“ä½œæ—¥å¿—è®°å½•

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰€æœ‰ API å®ç°æ•°æ®éš”ç¦»
- âœ… æ‰€æœ‰æ“ä½œè®°å½•å®¡è®¡æ—¥å¿—
- âœ… API æ–‡æ¡£å®Œæ•´ï¼ˆSwagger UIï¼‰

#### Phase 3: å‰ç«¯å¼€å‘ï¼ˆ2å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è·¯ç”±é…ç½®ï¼ˆä¾›åº”å•†ä¸“å±è·¯ç”±ï¼‰
- [ ] è·¯ç”±å®ˆå«ï¼ˆç”¨æˆ·ç±»å‹æ§åˆ¶ï¼‰
- [ ] ä¾›åº”å•†å¸ƒå±€ç»„ä»¶ï¼ˆ`SupplierLayout`ï¼‰
- [ ] å‘è´§å•åˆ—è¡¨/è¯¦æƒ…é¡µé¢
- [ ] å¼€ç¥¨ç®¡ç†é¡µé¢
- [ ] å¯¹è´¦å•é¡µé¢

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ä¾›åº”å•†ç™»å½•åè‡ªåŠ¨è·³è½¬åˆ°ä¾›åº”å•†é—¨æˆ·
- âœ… å†…éƒ¨ç”¨æˆ·æ— æ³•è®¿é—®ä¾›åº”å•†è·¯ç”±
- âœ… UI å“åº”å¼ï¼Œæ”¯æŒç§»åŠ¨ç«¯

#### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®‰å…¨æ€§æµ‹è¯•ï¼ˆè¶Šæƒã€æ³¨å…¥ã€XSSï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ200 å¹¶å‘ï¼‰
- [ ] å…¼å®¹æ€§æµ‹è¯•ï¼ˆChrome/Safari/å¾®ä¿¡æµè§ˆå™¨ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… é€šè¿‡å®‰å…¨æµ‹è¯•ï¼ˆæ— é«˜å±æ¼æ´ï¼‰
- âœ… å“åº”æ—¶é—´ < 2sï¼ˆ90åˆ†ä½ï¼‰
- âœ… ä¸»æµæµè§ˆå™¨å…¼å®¹

### 7.2 ä¸Šçº¿è®¡åˆ’

#### ç°åº¦å‘å¸ƒç­–ç•¥

| é˜¶æ®µ | èŒƒå›´ | ç”¨æˆ·æ•° | å‘¨æœŸ |
|------|------|--------|------|
| **Alpha** | å†…éƒ¨æµ‹è¯• | 5-10 ä¸ªæµ‹è¯•ä¾›åº”å•† | 1å‘¨ |
| **Beta** | å°èŒƒå›´è¯•ç‚¹ | 20-30 ä¸ªæ´»è·ƒä¾›åº”å•† | 2å‘¨ |
| **GA** | å…¨é‡å‘å¸ƒ | æ‰€æœ‰ä¾›åº”å•† | - |

#### å›æ»šæ–¹æ¡ˆ

```bash
# 1. æ•°æ®åº“å›æ»š
docker compose exec backend flask db downgrade

# 2. ä»£ç å›æ»š
git revert <commit-hash>
docker compose restart backend

# 3. å‰ç«¯å›æ»šï¼ˆNginx é…ç½®åˆ‡æ¢ï¼‰
ln -sf /var/www/frontend-v1 /var/www/frontend
nginx -s reload
```

---

## 8. ç›‘æ§ä¸è¿ç»´

### 8.1 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å‘Šè­¦é˜ˆå€¼ |
|------|--------|---------|
| **API å“åº”æ—¶é—´** | < 2s | > 5s |
| **é”™è¯¯ç‡** | < 1% | > 5% |
| **ç™»å½•æˆåŠŸç‡** | > 98% | < 95% |
| **æ–‡ä»¶ä¸Šä¼ æˆåŠŸç‡** | > 95% | < 90% |
| **å¹¶å‘ç”¨æˆ·æ•°** | - | > 200 |

### 8.2 æ—¥å¿—ç›‘æ§

```python
# å…³é”®æ“ä½œæ—¥å¿—ç¤ºä¾‹
{
  "timestamp": "2025-12-18T10:30:00Z",
  "level": "INFO",
  "operation": "supplier_login",
  "supplier_id": 5,
  "supplier_user_id": 123,
  "username": "huawei_zhangsan",
  "ip_address": "183.14.132.45",
  "user_agent": "Mozilla/5.0...",
  "result": "success"
}

{
  "timestamp": "2025-12-18T10:35:00Z",
  "level": "INFO",
  "operation": "invoice_upload",
  "supplier_id": 5,
  "supplier_user_id": 123,
  "resource_type": "supply_contract",
  "resource_id": 456,
  "invoice_no": "12345678",
  "file_size": 2048576,
  "result": "success"
}
```

---

## 9. é£é™©è¯„ä¼°ä¸åº”å¯¹

### 9.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| **æ•°æ®éš”ç¦»å¤±æ•ˆ** | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | å¤šå±‚é˜²æŠ¤ï¼šJWT æ ¡éªŒ + SQL è¿‡æ»¤ + ä»£ç å®¡æŸ¥ |
| **å¹¶å‘æ€§èƒ½ç“¶é¢ˆ** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– + Redis ç¼“å­˜ |
| **æ–‡ä»¶å­˜å‚¨æ•…éšœ** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | NAS å†—ä½™å¤‡ä»½ + å¼‚å¸¸å¤„ç† |

### 9.2 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| **ä¾›åº”å•†ä¸æ¥å—æ–°ç³»ç»Ÿ** | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | æä¾›åŸ¹è®­è§†é¢‘ + å®¢æœæ”¯æŒ |
| **æ“ä½œæµç¨‹å˜æ›´é˜»åŠ›** | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | ä¿ç•™æ—§æµç¨‹è¿‡æ¸¡æœŸï¼ˆ1ä¸ªæœˆï¼‰ |
| **æ•°æ®è¿ç§»é—®é¢˜** | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | å†å²æ•°æ®å¯¼å…¥è„šæœ¬ + äººå·¥æ ¸å¯¹ |

---

## 10. æœªæ¥æ¼”è¿›

### 10.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ3ä¸ªæœˆå†…ï¼‰

1. **æ‰‹æœºå·éªŒè¯ç ç™»å½•**ï¼šé™ä½å¯†ç è®°å¿†è´Ÿæ‹…
2. **å¾®ä¿¡å…¬ä¼—å·é›†æˆ**ï¼šæ¶ˆæ¯é€šçŸ¥æ¨é€
3. **æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼šæ‰¹é‡ç¡®è®¤å‘è´§ã€æ‰¹é‡ä¸Šä¼ å‘ç¥¨
4. **ç§»åŠ¨ç«¯ App**ï¼šåŸç”Ÿä½“éªŒ

### 10.2 ä¸­æœŸè§„åˆ’ï¼ˆ6-12ä¸ªæœˆï¼‰

1. **ä¾›åº”å•† API å¼€æ”¾**ï¼šä¾›åº”å•†ç³»ç»Ÿç›´æ¥å¯¹æ¥
2. **è‡ªåŠ¨å¯¹è´¦**ï¼šç³»ç»Ÿè‡ªåŠ¨æ¯”å¯¹å‘è´§æ•°é‡å’Œå‘ç¥¨é‡‘é¢
3. **ç”µå­ç­¾ç« **ï¼šåœ¨çº¿ç­¾ç½²åˆåŒå’Œå¯¹è´¦å•
4. **ä¾›åº”é“¾é‡‘è**ï¼šåŸºäºè®¢å•çš„ä¾›åº”é“¾èèµ„

### 10.3 é•¿æœŸæ„¿æ™¯

æ„å»º**ä¾›åº”å•†ååŒå¹³å°**ï¼š
- éœ€æ±‚é¢„æµ‹å…±äº«
- ååŒåº“å­˜ç®¡ç†ï¼ˆVMIï¼‰
- è´¨é‡è¿½æº¯ç³»ç»Ÿ
- ä¾›åº”å•†è¯„çº§ä½“ç³»

---

## 11. å‚è€ƒæ–‡æ¡£

- [æŠ€æœ¯æ¡†æ¶.md](./æŠ€æœ¯æ¡†æ¶.md)
- [å‘è´§å•é©±åŠ¨çš„åŒè½¨åˆ¶åˆåŒç³»ç»Ÿè®¾è®¡.md](./å‘è´§å•é©±åŠ¨çš„åŒè½¨åˆ¶åˆåŒç³»ç»Ÿè®¾è®¡.md)
- [æŠ¥å…³å•æƒé™ç³»ç»Ÿå®Œæ•´å®æ–½æ–¹æ¡ˆ.md](./æŠ¥å…³å•æƒé™ç³»ç»Ÿå®Œæ•´å®æ–½æ–¹æ¡ˆ.md)
- [Flask-JWT-Extended å®˜æ–¹æ–‡æ¡£](https://flask-jwt-extended.readthedocs.io/)
- [Vben Admin 5.0 æ–‡æ¡£](https://doc.vben.pro/)

---

## é™„å½• Aï¼šæ ¸å¿ƒä»£ç ç¤ºä¾‹

### A.1 å®Œæ•´çš„ç™»å½•æµç¨‹

```mermaid
sequenceDiagram
    participant F as å‰ç«¯
    participant A as è®¤è¯æ¥å£
    participant UT as users è¡¨
    participant ST as supplier_users è¡¨
    participant J as JWT
    
    F->>A: POST /api/v1/auth/login<br/>{username, password}
    A->>UT: æŸ¥è¯¢å†…éƒ¨ç”¨æˆ·
    
    alt å†…éƒ¨ç”¨æˆ·å­˜åœ¨
        UT-->>A: è¿”å›ç”¨æˆ·å¯¹è±¡
        A->>J: ç”Ÿæˆ Token<br/>(user_type=internal)
        J-->>A: access_token
        A-->>F: {user_type: 'internal', ...}
        F->>F: è·³è½¬åˆ° /dashboard
    else å†…éƒ¨ç”¨æˆ·ä¸å­˜åœ¨
        A->>ST: æŸ¥è¯¢ä¾›åº”å•†ç”¨æˆ·
        alt ä¾›åº”å•†ç”¨æˆ·å­˜åœ¨
            ST-->>A: è¿”å›ä¾›åº”å•†ç”¨æˆ·å¯¹è±¡
            A->>J: ç”Ÿæˆ Token<br/>(user_type=supplier)
            J-->>A: access_token
            A-->>F: {user_type: 'supplier', ...}
            F->>F: è·³è½¬åˆ° /supplier/shipments
        else éƒ½ä¸å­˜åœ¨
            A-->>F: 401 Invalid credentials
        end
    end
```

### A.2 æ•°æ®éš”ç¦»ç¤ºæ„å›¾

```mermaid
graph LR
    A[ä¾›åº”å•†Aç”¨æˆ·ç™»å½•] -->|JWT: supplier_id=1| B[è¯·æ±‚å‘è´§å•åˆ—è¡¨]
    B --> C{åç«¯éªŒè¯}
    C -->|æå– supplier_id| D[SQL: WHERE supplier_id=1]
    D --> E[åªè¿”å›ä¾›åº”å•†Açš„æ•°æ®]
    
    F[ä¾›åº”å•†Bç”¨æˆ·ç™»å½•] -->|JWT: supplier_id=2| G[è¯·æ±‚å‘è´§å•åˆ—è¡¨]
    G --> H{åç«¯éªŒè¯}
    H -->|æå– supplier_id| I[SQL: WHERE supplier_id=2]
    I --> J[åªè¿”å›ä¾›åº”å•†Bçš„æ•°æ®]
    
    style E fill:#90EE90
    style J fill:#90EE90
```

---

**æ–‡æ¡£ç»“æŸ**


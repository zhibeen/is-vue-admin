# 前端用户指南 - 权限系统更新说明

## 📢 重要通知

系统已完成权限体系升级，所有用户需要**重新登录**以获取最新的访问权限。

## 🔄 操作步骤

### 1. 退出当前登录

点击右上角用户头像 → 选择"退出登录"

### 2. 重新登录

使用原有账号密码重新登录系统

**默认管理员账号**:
- 用户名: `admin`
- 密码: `password`

### 3. 验证权限

登录成功后，你应该能够：

- ✅ 访问 "关务管理" 菜单
- ✅ 查看报关单列表
- ✅ 创建、编辑报关单
- ✅ 管理归类商品库
- ✅ 管理境外收货人

## 🔐 权限说明

### 关务模块权限列表

| 功能 | 所需权限 | Admin | 说明 |
|-----|---------|-------|------|
| 查看报关单 | `customs:view` | ✅ | 可查看报关单列表和详情 |
| 创建报关单 | `customs:create` | ✅ | 可新建报关单草稿 |
| 编辑报关单 | `customs:edit` | ✅ | 可修改报关单内容 |
| 删除报关单 | `customs:delete` | ✅ | 可删除草稿状态的报关单 |
| 审批报关单 | `customs:approve` | ✅ | 可变更报关单状态（提交审核、申报等） |
| 导出报关单 | `customs:export` | ✅ | 可导出Excel报表 |
| 查看报关品类 | `customs:product:view` | ✅ | 可查看归类商品库 |
| 管理报关品类 | `customs:product:manage` | ✅ | 可添加/编辑报关品类 |
| 查看收货人 | `customs:consignee:view` | ✅ | 可查看境外收货人列表 |
| 管理收货人 | `customs:consignee:manage` | ✅ | 可添加/编辑收货人信息 |

### 权限检查机制

系统采用**前后端双重验证**：

1. **前端**: 根据用户权限自动隐藏/禁用无权限的按钮和功能
2. **后端**: API层面强制验证权限，防止越权操作

## 🚨 常见问题

### Q1: 登录后仍然无法访问报关单页面

**A**: 请清除浏览器缓存并刷新页面，或使用 `Ctrl+F5` 强制刷新。

### Q2: 提示 "Insufficient permissions"

**A**: 
1. 确认你已重新登录
2. 联系系统管理员检查你的角色权限配置
3. 如果你是管理员，请运行权限初始化命令（见下方）

### Q3: 新注册的用户看不到关务模块

**A**: 新用户需要由管理员在"系统管理 → 角色管理"中分配相应角色和权限。

## 👨‍💼 管理员操作

### 为其他用户分配权限

1. 进入 "系统管理" → "角色管理"
2. 选择目标角色（或创建新角色）
3. 在"功能权限" Tab 中勾选 "关务管理" 相关权限
4. 保存配置
5. 在"用户管理"中将用户分配到该角色

### 创建自定义角色示例

**报关专员** (只能查看和编辑，不能审批):
- ✅ `customs:view`
- ✅ `customs:create`
- ✅ `customs:edit`
- ❌ `customs:approve` (不分配)

**报关主管** (可审批):
- ✅ 所有报关专员权限
- ✅ `customs:approve`

## 🔧 技术支持

### 后端权限初始化命令

如果权限丢失，管理员可以在服务器上运行以下命令重新初始化：

```bash
# 初始化权限
docker compose exec backend flask permissions seed-permissions

# 或者完整重置（谨慎使用）
docker compose exec backend flask core init-dev --reset
```

### 检查当前用户权限

在浏览器控制台执行：

```javascript
// 查看当前用户信息
console.log('用户信息:', useUserStore().userInfo);

// 查看所有权限
console.log('用户权限:', useAccessStore().accessCodes);
```

## 📞 联系我们

如有任何问题，请联系系统管理员或技术支持团队。

---

**最后更新**: 2025-12-17  
**版本**: v1.0  
**影响范围**: 所有用户


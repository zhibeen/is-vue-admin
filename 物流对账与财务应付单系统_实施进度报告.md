# ç‰©æµå¯¹è´¦ä¸è´¢åŠ¡åº”ä»˜å•ç³»ç»Ÿ - å®æ–½è¿›åº¦æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æ ¹æ®è·¨å¢ƒç”µå•†ä¸šåŠ¡éœ€æ±‚ï¼Œé‡æ–°è®¾è®¡äº†**ç‰©æµå¯¹è´¦**ä¸**è´¢åŠ¡åº”ä»˜å•**çš„åä½œæ¶æ„ï¼Œå®ç°äº†ä¸šåŠ¡æ¨¡å—ä¸è´¢åŠ¡æ¨¡å—çš„èŒè´£åˆ†ç¦»å’Œæµç¨‹é›†æˆã€‚

---

## âœ… å·²å®Œæˆå·¥ä½œï¼ˆåç«¯æ ¸å¿ƒï¼‰

### 1. æ•°æ®æ¨¡å‹è®¾è®¡ä¸è¿ç§»

#### 1.1 ç‰©æµå¯¹è´¦å•æ¨¡å‹å‡çº§ (`LogisticsStatement`)
- âœ… æ·»åŠ å¯¹è´¦å‘¨æœŸå­—æ®µ (`statement_period_start`, `statement_period_end`)
- âœ… æ‰©å±•çŠ¶æ€æšä¸¾ï¼š`draft` â†’ `confirmed` â†’ `submitted` â†’ `approved` â†’ `paid`
- âœ… æ·»åŠ è´¢åŠ¡å…³è”å­—æ®µ (`finance_payable_id`, `submitted_to_finance_at`)
- âœ… æ·»åŠ é™„ä»¶æ”¯æŒ (`attachment_ids`)
- âœ… æ ‡è®°æ—§å­—æ®µä¸º DEPRECATEDï¼ˆå‘åå…¼å®¹ï¼‰

#### 1.2 å¯¹è´¦å•-ç‰©æµæœåŠ¡å…³è”è¡¨ (`statement_service_relations`)
- âœ… å¤šå¯¹å¤šå…³ç³»è¡¨ï¼Œæ”¯æŒä¸€ä¸ªå¯¹è´¦å•å…³è”å¤šä¸ªç‰©æµæœåŠ¡
- âœ… è®°å½•æ¯æ¡æœåŠ¡çš„å¯¹è´¦é‡‘é¢ (`reconciled_amount`)
- âœ… çº§è”åˆ é™¤ä¿æŠ¤

#### 1.3 è´¢åŠ¡åº”ä»˜å•æ¨¡å‹ (`FinPayable`)
- âœ… ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ¥æºçš„åº”ä»˜æ¬¾ï¼ˆç‰©æµ/ä¾›è´§åˆåŒ/è´¹ç”¨ï¼‰
- âœ… æ”¯æŒå¤šç§æ”¶æ¬¾æ–¹ç±»å‹ï¼ˆç‰©æµå•†/ä¾›åº”å•†/å‘˜å·¥ï¼‰
- âœ… å®Œæ•´çš„å®¡æ‰¹æµç¨‹çŠ¶æ€ç®¡ç†
- âœ… ä»˜æ¬¾æ± å…³è”å’Œä»˜æ¬¾å‡­è¯ç®¡ç†
- âœ… è®¡ç®—å±æ€§ï¼š`remaining_amount`, `is_fully_paid`

#### 1.4 ä»˜æ¬¾æ± æ¨¡å‹ (`FinPaymentPool`)
- âœ… æ‰¹é‡ä»˜æ¬¾ç®¡ç†
- âœ… å®¡æ‰¹å’Œæ‰§è¡ŒçŠ¶æ€è·Ÿè¸ª
- âœ… è‡ªåŠ¨ç»Ÿè®¡æ± å†…åº”ä»˜å•æ•°é‡å’Œé‡‘é¢

#### 1.5 æ•°æ®åº“è¿ç§»
- âœ… ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼š`logistics_finance_v2_add_finance_payable.py`
- âœ… é‡‡ç”¨ ALTER TABLE ç­–ç•¥ï¼Œä¿ç•™ç°æœ‰æ•°æ®
- âœ… è‡ªåŠ¨æ•°æ®è¿ç§»ï¼šå°†æ—§çš„ `statement_date` è½¬æ¢ä¸ºå‘¨æœŸå­—æ®µ
- âœ… æˆåŠŸåº”ç”¨åˆ°æ•°æ®åº“

### 2. æœåŠ¡å±‚å®ç°

#### 2.1 ç‰©æµå¯¹è´¦æœåŠ¡ (`StatementService`)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… `create_draft_statement()` - åˆ›å»ºå¯¹è´¦å•è‰ç¨¿ï¼Œæ”¯æŒè‡ªåŠ¨åŒ…å«å‘¨æœŸå†…çš„ç‰©æµæœåŠ¡
- âœ… `add_service_to_statement()` - åŠ¨æ€æ·»åŠ ç‰©æµæœåŠ¡åˆ°å¯¹è´¦å•
- âœ… `remove_service_from_statement()` - ä»å¯¹è´¦å•ç§»é™¤ç‰©æµæœåŠ¡
- âœ… `confirm_statement()` - ç‰©æµä¸»ç®¡ç¡®è®¤å¯¹è´¦å•ï¼ˆå«é™„ä»¶æ ¡éªŒï¼‰
- âœ… `submit_to_finance()` - **æ ¸å¿ƒé›†æˆç‚¹**ï¼šè°ƒç”¨è´¢åŠ¡æ¨¡å—åˆ›å»ºåº”ä»˜å•
- âœ… `update_statement()` / `delete_statement()` - è‰ç¨¿çŠ¶æ€ç®¡ç†

**ä¸šåŠ¡é€»è¾‘äº®ç‚¹**ï¼š
```python
# æäº¤è´¢åŠ¡æ—¶çš„è‡ªåŠ¨åŒ–æµç¨‹
1. æ ¡éªŒå¯¹è´¦å•çŠ¶æ€ï¼ˆconfirmedï¼‰
2. è°ƒç”¨ PayableService.create_payable() åˆ›å»ºåº”ä»˜å•
3. å…³è”å¯¹è´¦å•ä¸åº”ä»˜å•
4. æ›´æ–°å¯¹è´¦å•çŠ¶æ€ä¸º submitted
5. æ›´æ–°ç‰©æµæœåŠ¡çŠ¶æ€ä¸º reconciled
```

#### 2.2 è´¢åŠ¡åº”ä»˜å•æœåŠ¡ (`PayableService`)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… `create_payable()` - åˆ›å»ºåº”ä»˜å•ï¼ˆä¾›å…¶ä»–æ¨¡å—è°ƒç”¨ï¼‰
- âœ… `approve_payable()` - å®¡æ‰¹åº”ä»˜å•ï¼ˆæ”¯æŒæ‰¹å‡†/é©³å›ï¼‰
- âœ… `add_payable_to_pool()` - å°†åº”ä»˜å•åŠ å…¥ä»˜æ¬¾æ± 
- âœ… `mark_as_paid()` - æ ‡è®°ä¸ºå·²ä»˜æ¬¾ï¼ˆæ”¯æŒéƒ¨åˆ†ä»˜æ¬¾ï¼‰
- âœ… `_notify_logistics_rejection()` - **å›è°ƒ**ï¼šé©³å›æ—¶é€šçŸ¥ç‰©æµæ¨¡å—
- âœ… `_notify_logistics_paid()` - **å›è°ƒ**ï¼šä»˜æ¬¾åæ›´æ–°ç‰©æµæœåŠ¡çŠ¶æ€

**ä»˜æ¬¾æ± è‡ªåŠ¨ç®¡ç†**ï¼š
```python
# è·å–æˆ–åˆ›å»ºæœ¬æœˆé»˜è®¤ä»˜æ¬¾æ± 
pool = _get_or_create_default_pool()
# æŒ‰ "YYYYå¹´MMæœˆä»˜æ¬¾æ± " å‘½åï¼Œè‡ªåŠ¨ç»Ÿè®¡
```

### 3. API è·¯ç”±å®ç°

#### 3.1 ç‰©æµå¯¹è´¦å• API (`/api/v1/logistics/statements`)

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | `/` | å¯¹è´¦å•åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ï¼‰ | - |
| POST | `/` | åˆ›å»ºå¯¹è´¦å•è‰ç¨¿ | `logistics:statement:create` |
| GET | `/:id` | å¯¹è´¦å•è¯¦æƒ…ï¼ˆå«ç‰©æµæœåŠ¡ï¼‰ | - |
| PUT | `/:id` | æ›´æ–°å¯¹è´¦å• | `logistics:statement:update` |
| DELETE | `/:id` | åˆ é™¤å¯¹è´¦å• | `logistics:statement:delete` |
| POST | `/:id/confirm` | ç¡®è®¤å¯¹è´¦å• | `logistics:statement:confirm` |
| POST | `/:id/submit` | æäº¤è´¢åŠ¡å®¡æ‰¹ | `logistics:statement:submit` |
| POST | `/:id/services` | æ·»åŠ ç‰©æµæœåŠ¡ | `logistics:statement:update` |
| DELETE | `/:id/services/:service_id` | ç§»é™¤ç‰©æµæœåŠ¡ | `logistics:statement:update` |

**å…³é”® API ç¤ºä¾‹**ï¼š
```python
# POST /api/v1/logistics/statements/:id/submit
# å“åº”ç¤ºä¾‹ï¼š
{
  "code": 0,
  "data": {
    "statement_id": 123,
    "finance_payable_id": 456,
    "finance_payable_no": "AP20250120001",
    "submitted_at": "2025-01-20T10:30:00"
  }
}
```

#### 3.2 Schema å®šä¹‰å®Œæ•´
- âœ… `LogisticsStatementSchema` - åŸºç¡€Schema
- âœ… `CreateStatementSchema` - åˆ›å»ºSchemaï¼ˆå«æ—¥æœŸæ ¡éªŒï¼‰
- âœ… `UpdateStatementSchema` - æ›´æ–°Schema
- âœ… `LogisticsStatementDetailSchema` - è¯¦æƒ…Schemaï¼ˆå«å…³è”æ•°æ®ï¼‰
- âœ… `StatementSubmitResponseSchema` - æäº¤å“åº”Schema

### 4. ç³»ç»Ÿé›†æˆ

#### 4.1 Blueprint æ³¨å†Œ
```python
# backend/app/api/__init__.py
from .logistics.statement_routes import statement_bp
api_v1.register_blueprint(statement_bp)  # âœ… å·²æ³¨å†Œ
```

#### 4.2 åç«¯æœåŠ¡å·²é‡å¯
```bash
docker compose restart backend  # âœ… æˆåŠŸ
```

---

## ğŸ“Š æ¶æ„è®¾è®¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç‰©æµç®¡ç†æ¨¡å—ï¼ˆä¸šåŠ¡ä¾§ï¼‰                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç‰©æµä¸“å‘˜å½•å…¥ç‰©æµæœåŠ¡è´¹ç”¨                         â”‚
â”‚    ShipmentLogisticsService (status=pending)       â”‚
â”‚                                                    â”‚
â”‚ 2. ç‰©æµä¸“å‘˜ç¡®è®¤è´¹ç”¨                                 â”‚
â”‚    ShipmentLogisticsService (status=confirmed)     â”‚
â”‚                                                    â”‚
â”‚ 3. ç‰©æµä¸“å‘˜ç”Ÿæˆå¯¹è´¦å•                               â”‚
â”‚    LogisticsStatement (status=draft)               â”‚
â”‚    â†“ å…³è”å¤šä¸ª ShipmentLogisticsService              â”‚
â”‚                                                    â”‚
â”‚ 4. ç‰©æµä¸»ç®¡ç¡®è®¤å¯¹è´¦å•                               â”‚
â”‚    LogisticsStatement (status=confirmed)           â”‚
â”‚    â†“ æ ¡éªŒï¼šé™„ä»¶ + æ€»é¢ > 0                         â”‚
â”‚                                                    â”‚
â”‚ 5. æäº¤ç»™è´¢åŠ¡ â­ é›†æˆç‚¹                             â”‚
â”‚    StatementService.submit_to_finance()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ API è°ƒç”¨
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è´¢åŠ¡ä¸­å°ï¼ˆèµ„é‡‘ç®¡æ§ï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. è‡ªåŠ¨åˆ›å»ºåº”ä»˜å•                                   â”‚
â”‚    PayableService.create_payable()                 â”‚
â”‚    FinPayable (source_type='logistics')            â”‚
â”‚                                                    â”‚
â”‚ 7. è´¢åŠ¡ä¸“å‘˜å®¡æ ¸                                     â”‚
â”‚    FinPayable (status=pending â†’ approved/rejected) â”‚
â”‚    â†“ é©³å›æ—¶å›è°ƒç‰©æµæ¨¡å—                            â”‚
â”‚                                                    â”‚
â”‚ 8. è´¢åŠ¡ä¸»ç®¡å®¡æ‰¹ & åŠ å…¥ä»˜æ¬¾æ±                         â”‚
â”‚    FinPayable (payment_pool_id=xxx)                â”‚
â”‚    FinPaymentPool (total_amount +=)                â”‚
â”‚                                                    â”‚
â”‚ 9. å‡ºçº³æ‰§è¡Œä»˜æ¬¾                                     â”‚
â”‚    PayableService.mark_as_paid()                   â”‚
â”‚    â†“ å›è°ƒç‰©æµæ¨¡å—æ›´æ–°çŠ¶æ€                          â”‚
â”‚                                                    â”‚
â”‚ 10. è‡ªåŠ¨å›å†™ç‰©æµæœåŠ¡çŠ¶æ€                            â”‚
â”‚     ShipmentLogisticsService (status=paid)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡å†³ç­–

### 1. èŒè´£åˆ†ç¦»
- âœ… **ç‰©æµæ¨¡å—**ï¼šè´Ÿè´£ä¸šåŠ¡ä¾§å¯¹è´¦ã€è´¹ç”¨ç¡®è®¤
- âœ… **è´¢åŠ¡æ¨¡å—**ï¼šè´Ÿè´£èµ„é‡‘ç®¡æ§ã€å®¡æ‰¹ã€ä»˜æ¬¾æ‰§è¡Œ
- âœ… **é€šè¿‡ API é›†æˆ**ï¼Œä¸æ˜¯æ•°æ®åº“å¤–é”®ï¼ˆæ¾è€¦åˆï¼‰

### 2. å•ä¸€ä»˜æ¬¾å‡ºå£
- âœ… æ‰€æœ‰ä¸šåŠ¡æ¨¡å—çš„ä»˜æ¬¾éƒ½é€šè¿‡ `FinPayable` ç»Ÿä¸€ç®¡ç†
- âœ… è´¢åŠ¡æ˜¯å”¯ä¸€çš„ä»˜æ¬¾å®¡æ‰¹å’Œæ‰§è¡Œå…¥å£
- âœ… é˜²æ­¢èµ„é‡‘å¤±æ§å’Œé‡å¤ä»˜æ¬¾

### 3. åŒå‘å›è°ƒ
- âœ… **è´¢åŠ¡ â†’ ç‰©æµ**ï¼šé©³å›æ—¶é€šçŸ¥ä¸šåŠ¡æ¨¡å—
- âœ… **è´¢åŠ¡ â†’ ç‰©æµ**ï¼šä»˜æ¬¾åè‡ªåŠ¨æ›´æ–°æœåŠ¡çŠ¶æ€
- âœ… ä¿è¯æ•°æ®ä¸€è‡´æ€§

### 4. å¯æ‰©å±•æ€§
- âœ… `FinPayable.source_type` æ”¯æŒå¤šç§æ¥æºï¼ˆlogistics/supply_contract/expenseï¼‰
- âœ… æœªæ¥ä¾›è´§åˆåŒä»˜æ¬¾ã€è´¹ç”¨æŠ¥é”€éƒ½èµ°åŒæ ·æµç¨‹
- âœ… ç»Ÿä¸€çš„ä»˜æ¬¾æ± å’Œå®¡æ‰¹æœºåˆ¶

---

## â³ å¾…å®Œæˆå·¥ä½œ

### åç«¯
- [ ] **è´¢åŠ¡åº”ä»˜å• API è·¯ç”±** (`/api/v1/finance/payables`)
  - GET `/` - åº”ä»˜å•åˆ—è¡¨
  - GET `/:id` - åº”ä»˜å•è¯¦æƒ…
  - POST `/:id/approve` - å®¡æ‰¹åº”ä»˜å•
  - POST `/:id/add-to-pool` - åŠ å…¥ä»˜æ¬¾æ± 
  - POST `/:id/mark-paid` - æ ‡è®°å·²ä»˜æ¬¾
  
- [ ] **è´¢åŠ¡åº”ä»˜å• Schema** (`backend/app/schemas/serc/payable.py`)
  - FinPayableSchema
  - ApprovalSchema
  - MarkPaidSchema

### å‰ç«¯
- [ ] **ç‰©æµå¯¹è´¦å•åˆ—è¡¨é¡µé¢** (`frontend/apps/web-antd/src/views/logistics/statement/index.vue`)
  - VXE Grid å±•ç¤ºå¯¹è´¦å•
  - ç­›é€‰ï¼šç‰©æµå•†ã€çŠ¶æ€ã€å‘¨æœŸ
  - æ“ä½œï¼šåˆ›å»ºã€æŸ¥çœ‹ã€ç¡®è®¤ã€æäº¤

- [ ] **ç‰©æµå¯¹è´¦å•è¯¦æƒ…é¡µé¢** (`frontend/apps/web-antd/src/views/logistics/statement/detail.vue`)
  - å¯¹è´¦å•åŸºæœ¬ä¿¡æ¯
  - å…³è”çš„ç‰©æµæœåŠ¡æ˜ç»†è¡¨æ ¼
  - é™„ä»¶ä¸Šä¼ /ä¸‹è½½
  - æ“ä½œæŒ‰é’®ï¼šç¡®è®¤ã€æäº¤è´¢åŠ¡

- [ ] **è´¢åŠ¡åº”ä»˜å•åˆ—è¡¨é¡µé¢** (`frontend/apps/web-antd/src/views/finance/payable/index.vue`)
  - æŒ‰æ¥æºç±»å‹ç­›é€‰ï¼ˆç‰©æµ/ä¾›è´§åˆåŒ/è´¹ç”¨ï¼‰
  - æ‰¹é‡å®¡æ‰¹åŠŸèƒ½
  - åŠ å…¥ä»˜æ¬¾æ± 
  - ä»˜æ¬¾æ‰§è¡Œ

- [ ] **å‰ç«¯ API å®šä¹‰** (`frontend/apps/web-antd/src/api/logistics/statement.ts`)
  ```typescript
  export function getStatementList(params: any) { ... }
  export function createStatement(data: any) { ... }
  export function confirmStatement(id: number) { ... }
  export function submitToFinance(id: number) { ... }
  ```

- [ ] **å‰ç«¯è·¯ç”±é…ç½®** (`frontend/apps/web-antd/src/router/routes/modules/logistics.ts`)
  ```typescript
  {
    path: 'statement',
    name: 'LogisticsStatement',
    component: () => import('#/views/logistics/statement/index.vue'),
    meta: { title: 'ç‰©æµå¯¹è´¦' }
  }
  ```

---

## ğŸ” æµ‹è¯•å»ºè®®

### 1. åç«¯ API æµ‹è¯•
```bash
# æŸ¥çœ‹ Swagger æ–‡æ¡£
http://localhost:5000/docs

# æµ‹è¯•åˆ›å»ºå¯¹è´¦å•
curl -X POST http://localhost:5000/api/v1/logistics/statements \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "logistics_provider_id": 1,
    "statement_period_start": "2025-01-01",
    "statement_period_end": "2025-01-31",
    "auto_include_services": true
  }'
```

### 2. æ•°æ®åº“éªŒè¯
```sql
-- æŸ¥çœ‹æ–°è¡¨
SELECT * FROM fin_payables;
SELECT * FROM fin_payment_pools;
SELECT * FROM statement_service_relations;

-- æŸ¥çœ‹å¯¹è´¦å•
SELECT id, statement_no, status, total_amount, finance_payable_id
FROM logistics_statements;
```

### 3. ä¸šåŠ¡æµç¨‹æµ‹è¯•
1. åˆ›å»ºç‰©æµæœåŠ¡è®°å½•ï¼ˆé€šè¿‡å‘è´§å•ï¼‰
2. ç¡®è®¤ç‰©æµæœåŠ¡è´¹ç”¨
3. ç”Ÿæˆå¯¹è´¦å•å¹¶å…³è”æœåŠ¡
4. ç‰©æµä¸»ç®¡ç¡®è®¤å¯¹è´¦å•
5. æäº¤è´¢åŠ¡å®¡æ‰¹
6. æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„åº”ä»˜å•
7. è´¢åŠ¡å®¡æ‰¹åº”ä»˜å•
8. åŠ å…¥ä»˜æ¬¾æ± 
9. æ ‡è®°å·²ä»˜æ¬¾
10. éªŒè¯ç‰©æµæœåŠ¡çŠ¶æ€è‡ªåŠ¨æ›´æ–°ä¸º paid

---

## ğŸ“ å…³é”®ä»£ç ç‰‡æ®µ

### æäº¤è´¢åŠ¡çš„æ ¸å¿ƒé€»è¾‘
```python
# backend/app/services/logistics/statement_service.py
@staticmethod
def submit_to_finance(statement_id: int) -> Dict[str, Any]:
    from app.services.serc.payable_service import PayableService
    
    statement = db.session.get(LogisticsStatement, statement_id)
    provider = statement.logistics_provider
    
    # å‡†å¤‡åº”ä»˜å•æ•°æ®
    payable_data = {
        'source_type': 'logistics',
        'source_id': statement.id,
        'payee_type': 'logistics_provider',
        'payee_id': provider.id,
        'payable_amount': statement.total_amount,
        # ... å…¶ä»–å­—æ®µ
    }
    
    # è°ƒç”¨è´¢åŠ¡æ¨¡å—
    payable = PayableService.create_payable(payable_data)
    
    # å…³è”å¹¶æ›´æ–°çŠ¶æ€
    statement.finance_payable_id = payable.id
    statement.status = StatementStatus.SUBMITTED.value
    
    # æ›´æ–°ç‰©æµæœåŠ¡çŠ¶æ€
    for service in statement.logistics_services:
        service.status = ServiceStatus.RECONCILED.value
    
    db.session.commit()
    return { ... }
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ç«‹å³å®Œæˆ**ï¼šè´¢åŠ¡åº”ä»˜å• API è·¯ç”±ï¼ˆå¤ç”¨ç°æœ‰ Serviceï¼‰
2. **å‰ç«¯å¼€å‘**ï¼šæŒ‰ä¼˜å…ˆçº§å®ç°é¡µé¢
   - ä¼˜å…ˆçº§ 1ï¼šç‰©æµå¯¹è´¦å•åˆ—è¡¨å’Œåˆ›å»º
   - ä¼˜å…ˆçº§ 2ï¼šå¯¹è´¦å•è¯¦æƒ…å’Œæäº¤
   - ä¼˜å…ˆçº§ 3ï¼šè´¢åŠ¡åº”ä»˜å•å®¡æ‰¹ç•Œé¢
3. **é›†æˆæµ‹è¯•**ï¼šå®Œæ•´ä¸šåŠ¡æµç¨‹ç«¯åˆ°ç«¯æµ‹è¯•
4. **æƒé™é…ç½®**ï¼šä¸ºå„è§’è‰²åˆ†é…å¯¹åº”æƒé™
5. **æ–‡æ¡£å®Œå–„**ï¼šç”¨æˆ·æ“ä½œæ‰‹å†Œ

---

## ğŸ’¡ æ€»ç»“

æœ¬æ¬¡å®æ–½å®Œæˆäº†**ç‰©æµå¯¹è´¦ä¸è´¢åŠ¡åº”ä»˜å•ç³»ç»Ÿ**çš„æ ¸å¿ƒåç«¯æ¶æ„ï¼Œå®ç°äº†ï¼š

âœ… ä¸šåŠ¡æ¨¡å—ä¸è´¢åŠ¡æ¨¡å—çš„èŒè´£åˆ†ç¦»  
âœ… é€šè¿‡ API é›†æˆè€Œéç´§è€¦åˆ  
âœ… ç»Ÿä¸€çš„ä»˜æ¬¾å‡ºå£å’Œå®¡æ‰¹æµç¨‹  
âœ… åŒå‘å›è°ƒä¿è¯æ•°æ®ä¸€è‡´æ€§  
âœ… é«˜åº¦å¯æ‰©å±•çš„æ¶æ„è®¾è®¡  

ä¸‹ä¸€æ­¥å°†é‡ç‚¹å®Œæˆ**è´¢åŠ¡åº”ä»˜å• API** å’Œ**å‰ç«¯é¡µé¢å¼€å‘**ï¼Œå®ç°å®Œæ•´çš„ä¸šåŠ¡é—­ç¯ã€‚


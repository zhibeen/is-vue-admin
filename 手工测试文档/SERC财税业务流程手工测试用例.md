# SERC 财税业务流程手工测试用例

本文档罗列了 SERC 系统财税业务流程的核心测试场景。请按照以下清单逐项进行操作，以验证系统功能的完整性和正确性。

---

## 测试环境准备
1.  **用户角色**: 建议使用拥有完整权限的超级管理员账号（或分别使用采购、财务、关务账号）。
2.  **基础数据**:
    -   确保已存在至少一个**供应商** (`Supplier`)，且已配置默认税率（如 0.13）。
    -   确保已存在至少一个**采购主体** (`Company`)。
    -   确保已存在至少一个**商品** (`Product`)，且已设置报关品名和 HS 编码。

---

## 第一阶段：供应链交付与财务结算 (L1 -> L2 -> L3)

**目标**：验证从实物交付到资金付款的完整闭环。

### 1. L1 交付合同录入
*   **入口**: `SERC 业财税 > 供应链交付 > 交付合同管理`
*   **操作**:
    1.  点击 **“手工录入合同(新)”**。
    2.  填写合同编号、选择供应商、采购主体。
    3.  添加商品明细（如：商品A，数量 1000，单价 10）。
    4.  点击 **“提交”**。
*   **预期**: 列表新增一条合同，状态为 `待处理` (`pending`)。

### 2. L1.5 供货合同预览与生成
*   **入口**: `SERC 业财税 > 供应链交付 > 交付合同管理`
*   **操作**:
    1.  找到刚才创建的合同，点击操作列的 **“编制结算”**。
    2.  在弹出的预览抽屉中：
        *   **测试点**: 修改某行商品的“税率”（如改为 `0.01`）。
        *   **测试点**: 修改“开票品名”。
    3.  点击 **“确认生成结算书”**。
*   **预期**: 提示生成成功，列表页该合同状态变更为 `结算中` (`settling`)。

### 3. L2 结算单 (SOA) 生成
*   **入口**: `SERC 业财税 > 供应链交付 > 交付合同管理`
*   **操作**:
    1.  勾选刚才处理的那条合同（可多选同一供应商的合同）。
    2.  点击列表上方的 **“生成对账单 (SOA)”** 按钮。
*   **预期**: 提示生成成功。

### 4. L2 SOA 确认与批准
*   **入口**: `SERC 业财税 > 资金结算中心 > 采购结算单`
*   **操作**:
    1.  找到新生成的 SOA（状态：`草稿/Draft`）。
    2.  点击 **“查看”**，确认明细无误。
    3.  点击操作列的 **“确认对账”**。
        *   **预期**: 状态变更为 `已确认/Confirmed`。
    4.  点击操作列的 **“批准付款”**。
        *   **预期**: 状态变更为 `已批准/Approved`，提示付款计划已生成。

### 5. L3 资金池合并支付
*   **入口**: `SERC 业财税 > 资金结算中心 > 资金付款池`
*   **操作**:
    1.  列表应显示刚才批准的款项（状态：`待审批/Pending Approval`）。
    2.  勾选该笔款项，点击 **“合并支付 (生成L3)”**。
    3.  选择付款银行账号，点击确认。
*   **预期**: 提示付款单生成成功，列表刷新，该条目状态变为 `已支付/Paid`（或消失，取决于过滤逻辑）。

---

## 第二阶段：税务风控与退税匹配 (Risk & Tax)

**目标**：验证换汇成本风控阻断及报关单发票凑数逻辑。

### 1. 报关单填报与风控 (事前)
*   **入口**: `SERC 业财税 > 供应链交付 > 交付合同管理` (暂定入口，或者是独立的 `Tax` 菜单，假设在 `Tax` 下) -> *需确认菜单位置，假设为 `SERC 业财税 > 关务风控 > 报关单管理`*
*   **操作**:
    1.  点击 **“新建报关单”**。
    2.  **测试阻断**: 输入 `FOB总额 = 100`, `采购成本 = 1000` (换汇成本=10)。
        *   **预期**: 界面显示**红色**风控阻断提示，无法提交。
    3.  **测试通过**: 修改 `FOB总额 = 150` (换汇成本≈6.6)。
        *   **预期**: 界面显示**绿色**通过提示，显示当前换汇成本。
    4.  填写报关单号，点击 **“提交”**。
*   **预期**: 列表新增一条报关单，状态为 `草稿`。

### 2. 智能匹配 (事中)
*   **入口**: 报关单列表页
*   **操作**:
    1.  找到新建的报关单，点击 **“智能匹配”**。
    2.  系统弹出匹配窗口，展示“报关项”与“发票”的对应关系。
    3.  **预期**:
        *   如果发票额度充足，显示“全单匹配成功”。
        *   如果发票额度不足，显示“匹配失败”及原因。
    4.  (在成功情况下) 点击 **“确认锁定发票”**。
*   **预期**: 提示成功，报关单状态变更为 `预申报`。

### 3. 逆向流程 (事后)
*   **入口**: 报关单列表页
*   **操作**:
    1.  找到刚才已锁定的报关单（状态：`预申报`）。
    2.  点击操作列的 **“解除匹配”**。
    3.  在二次确认框中点击确认。
*   **预期**: 提示额度已释放，报关单状态回滚为 `草稿`。

---

## 第三阶段：辅助功能测试

### 1. 业务流程图
*   **入口**: `SERC 业财税 > 业务流程图`
*   **检查**: 确认流程图加载正常，节点连线逻辑清晰，无渲染错误。

### 2. 导出功能
*   **入口**: `交付合同管理` 或 `采购结算单`
*   **操作**: 点击 **“导出 Excel”**。
*   **预期**: 浏览器下载 `.xlsx` 文件，内容与列表数据被正确导出。


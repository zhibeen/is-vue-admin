# 前端开发规范 (Frontend Development Standards)

## 技术栈

- **框架**: Vue 3 + TypeScript
- **UI 库**: Ant Design Vue (Vben Admin 5.0 深度集成)
- **状态管理**: Pinia
- **路由管理**: Vue Router
- **构建工具**: Vite
- **包管理器**: pnpm (version >= 9)
- **运行环境**: 本地 Node.js (v20+) 环境

## VXE Table v4.17+ 语法规范

### ⚠️ 重要提醒

VXE Table 从 v4.x 开始对 `toolbarConfig` 进行了重大更新，旧版语法已废弃。**AI 助手必须使用新版语法！**

### 工具栏配置语法变更

#### ❌ 旧版语法（已废弃 - 禁止使用）
```typescript
toolbarConfig: {
  refresh: { code: 'query' },      // ❌ 废弃
  zoom: { code: 'fullscreen' },    // ❌ 废弃
  custom: { code: 'custom' },      // ❌ 废弃
}
```

#### ✅ 新版语法（强制使用）
```typescript
toolbarConfig: {
  // 刷新按钮：分离布尔值和配置对象
  refresh: true,                    // ✅ 是否启用
  refreshOptions: { code: 'query' }, // ✅ 配置选项
  
  // 全屏按钮
  zoom: true,
  zoomOptions: { code: 'fullscreen' },
  
  // 自定义按钮
  custom: true,
  customOptions: { code: 'custom' },
}
```

### 配置对照表

| 功能 | 旧版（废弃） | 新版（推荐） |
|------|-------------|-------------|
| 刷新按钮 | `refresh: { code: 'query' }` | `refresh: true, refreshOptions: { code: 'query' }` |
| 全屏按钮 | `zoom: { code: 'fullscreen' }` | `zoom: true, zoomOptions: { code: 'fullscreen' }` |
| 自定义按钮 | `custom: { code: 'custom' }` | `custom: true, customOptions: { code: 'custom' }` |
| 列设置 | `setting: { code: 'setting' }` | `setting: true, settingOptions: { code: 'setting' }` |

### 标准模板（AI 必须遵循）

```vue
<script setup lang="ts">
import { useVbenVxeGrid, type VxeGridProps } from '#/adapter/vxe-table';
import { getListApi } from '#/api/demo';
import { onMounted } from 'vue';
import { Button } from 'ant-design-vue';

// 1. 定义 Grid Options
const gridOptions: VxeGridProps = {
  columns: [
    { field: 'id', title: 'ID', width: 80 },
    { field: 'name', title: '名称', minWidth: 150 },
  ],
  data: [], // 初始空数据
  
  // 分页配置
  pagerConfig: {
    enabled: true,
    currentPage: 1,
    pageSize: 20,
  },
  
  // 工具栏配置（新版语法）
  toolbarConfig: {
    // 刷新按钮
    refresh: true,
    refreshOptions: { code: 'query' },
    
    // 全屏按钮（可选）
    zoom: true,
    zoomOptions: { code: 'fullscreen' },
    
    // 自定义按钮
    custom: true,
    
    // 自定义按钮插槽
    slots: {
      buttons: 'toolbar_buttons'
    }
  },
};

// 2. 初始化 Grid
const [Grid, gridApi] = useVbenVxeGrid({ 
  gridOptions,
  gridEvents: {
    // 工具栏按钮点击事件
    toolbarToolClick: (params) => {
      if (params.code === 'query') {
        loadData();  // 刷新数据
      }
    }
  }
});

// 3. 数据加载函数
async function loadData() {
  try {
    gridApi.setLoading(true);
    const res = await getListApi();
    // 显式更新 Grid 数据
    gridApi.setGridOptions({ data: res });
  } catch (e) {
    console.error(e);
  } finally {
    gridApi.setLoading(false);
  }
}

// 4. 挂载时触发
onMounted(() => {
  loadData();
});
</script>

<template>
  <div class="p-4">
    <Grid>
      <!-- 自定义工具栏按钮 -->
      <template #toolbar_buttons>
        <Button type="primary" @click="handleCreate">
          新建
        </Button>
      </template>
    </Grid>
  </div>
</template>
```

**关键点**:
1. **引入 Adapter**: 使用 `#/adapter/vxe-table`
2. **手动加载**: 使用 `loadData` 函数 + `gridApi.setGridOptions({ data })`
3. **生命周期**: 在 `onMounted` 中显式调用 `loadData()`
4. **刷新绑定**: 通过 `gridEvents.toolbarToolClick` 绑定刷新按钮
5. **新版语法**: 工具栏配置使用 `布尔值 + Options对象` 的分离模式

### 快速参考

```typescript
// ✅ 最小配置
toolbarConfig: {
  refresh: true,
  refreshOptions: { code: 'query' },
}

// ✅ 完整配置
toolbarConfig: {
  refresh: true,
  refreshOptions: { code: 'query' },
  zoom: true,
  zoomOptions: { code: 'fullscreen' },
  custom: true,
  setting: true,
  settingOptions: { storage: true },
  slots: { buttons: 'toolbar_buttons' }
}
```

## Ant Design Vue 组件导入规范

### 问题说明

在 Vue 3 的 `<script setup>` 语法中，模板中使用的组件必须在 script 中导入。

### ❌ 错误示例
```vue
<script setup lang="ts">
import { message } from 'ant-design-vue';
</script>

<template>
  <a-button>按钮</a-button>  <!-- ❌ 错误：a-button 未导入 -->
</template>
```

### ✅ 正确示例
```vue
<script setup lang="ts">
import { Button, Tag, Space, message } from 'ant-design-vue';
</script>

<template>
  <Button>按钮</Button>  <!-- ✅ 正确 -->
  <Tag>标签</Tag>
  <Space>
    <Button>按钮1</Button>
    <Button>按钮2</Button>
  </Space>
</template>
```

### 常用组件导入清单

```typescript
// 表单相关
import { Form, FormItem, Input, InputNumber, Select, SelectOption, Switch, Textarea, DatePicker, Checkbox, Radio } from 'ant-design-vue';

// 数据展示
import { Table, Tag, Descriptions, Card, Statistic } from 'ant-design-vue';

// 布局相关
import { Space, Row, Col } from 'ant-design-vue';

// 交互组件
import { Button, Modal, message, Spin, Alert, Empty } from 'ant-design-vue';

// 时间线
import { Timeline, TimelineItem } from 'ant-design-vue';

// 步骤条
import { Steps, Step } from 'ant-design-vue';

// 上传
import { Upload } from 'ant-design-vue';
```

### AI 行为规范

1. **生成 Vue 组件时**：检查模板中使用的所有 Ant Design 组件是否已在 script 中导入
2. **修复错误时**：如果发现 `Failed to resolve component: a-xxx` 错误，应立即添加对应的导入语句
3. **使用命名导入**：优先使用 `Button` 而非 `a-button` 的方式

## API 调用规范

### 使用 requestClient

**正确的导入和使用方式**:

```typescript
import { requestClient } from '#/api/request';

// 定义接口类型
export interface Product {
  id: number;
  name: string;
  price: number;
}

// 定义 API 函数
export function getProductList(params: { page: number; per_page: number }) {
  return requestClient.get<{ items: Product[]; total: number }>('/api/v1/products', {
    params,
  });
}

export function createProduct(data: Partial<Product>) {
  return requestClient.post<Product>('/api/v1/products', data);
}

export function updateProduct(id: number, data: Partial<Product>) {
  return requestClient.put<Product>(`/api/v1/products/${id}`, data);
}

export function deleteProduct(id: number) {
  return requestClient.delete(`/api/v1/products/${id}`);
}
```

**重要**:
- ✅ 使用 `requestClient` 而非 `request`
- ✅ 导入路径使用 `#/api/request`
- ✅ 为返回值添加 TypeScript 类型定义

## 样式与主题规范

### Tailwind CSS 优先原则

**强制使用 Tailwind CSS**:
- **优先使用 Utility Classes**: 布局、间距、颜色等应优先使用 Tailwind 类名
- **避免自定义 CSS**: 尽量少写 `<style scoped>`，除非是复杂的动画或 Tailwind 无法实现的特殊样式
- **严禁使用 `!important`**: 除非万不得已，禁止使用 `!important` 覆盖框架样式，这会导致深色模式适配困难

### 深色模式适配

**必须遵循的原则**:
- **使用 Ant Design Vue 组件**: 容器类组件（如 `Card`, `Modal`, `Drawer`）自带深色模式适配，优先使用它们包裹内容
- **避免手动设置背景色**: 不要手动写 `background: #fff` 或 `bg-white`，除非你明确知道在深色模式下它也应该是白色的
- **使用 CSS 变量**: 如果必须自定义颜色，请使用 Ant Design 的 CSS 变量（如 `var(--bg-color-container)`）以支持动态切换

### 正确示例

```vue
<template>
  <!-- ✅ 正确：使用 Tailwind + Ant Design 组件 -->
  <Card class="mb-4">
    <div class="flex items-center justify-between p-4">
      <span class="text-lg font-semibold">标题</span>
      <Button type="primary">操作</Button>
    </div>
  </Card>
  
  <!-- ❌ 错误：手动设置白色背景 -->
  <div style="background: #fff" class="p-4">
    内容
  </div>
  
  <!-- ❌ 错误：使用 !important -->
  <div class="!bg-white p-4">
    内容
  </div>
</template>
```

## 权限控制

### 使用 v-auth 指令

```vue
<template>
  <!-- 功能权限控制 -->
  <Button v-auth="'product:create'" @click="handleCreate">
    新建商品
  </Button>
  
  <!-- 多权限控制（需要任一权限） -->
  <Button v-auth="['product:edit', 'product:delete']" @click="handleEdit">
    编辑
  </Button>
</template>
```

## 代码质量要求

### 格式化工具
- **ESLint + Prettier**: 自动代码格式化
- **类型安全**: 严格模式 TypeScript

### 组件规范
- **使用 `<script setup>` 语法**: 所有新组件必须使用 Composition API
- **Props 类型定义**: 使用 `defineProps<T>()` 声明 props 类型
- **Emits 定义**: 使用 `defineEmits<T>()` 声明事件类型

### 代码注释
- **组件顶部需注释组件用途**
- **复杂函数/逻辑需添加注释**
- **接口调用处需简要说明**

### 正确示例

```vue
<script setup lang="ts">
/**
 * 商品列表组件
 * 功能：展示商品列表、支持搜索、分页、新建编辑删除操作
 */
import { ref, onMounted } from 'vue';
import { Button, message } from 'ant-design-vue';
import { getProductList, deleteProduct } from '#/api/product';

// Props 定义
interface Props {
  categoryId?: number;
}
const props = defineProps<Props>();

// Emits 定义
interface Emits {
  (e: 'refresh'): void;
}
const emit = defineEmits<Emits>();

// 加载商品列表
async function loadProducts() {
  try {
    // 调用 API 获取商品列表
    const res = await getProductList({ page: 1, per_page: 20 });
    // ... 处理数据
  } catch (error) {
    message.error('加载失败');
  }
}

onMounted(() => {
  loadProducts();
});
</script>
```

## 项目结构

```
frontend/
├── apps/
│   └── web-antd/          # 主应用
│       ├── src/
│       │   ├── api/       # API 接口定义
│       │   ├── views/     # 页面组件
│       │   ├── router/    # 路由配置
│       │   └── store/     # Pinia 状态管理
└── packages/              # 共享包
```

## AI 行为规范总结

1. **VXE Table**: 必须使用新版 toolbarConfig 语法，禁止使用旧版语法
2. **组件导入**: 检查所有 Ant Design 组件是否已正确导入
3. **API 调用**: 使用 `requestClient` 而非 `request`
4. **样式**: 优先使用 Tailwind CSS，严禁滥用 `!important`
5. **深色模式**: 使用 Ant Design 组件和 CSS 变量，避免硬编码颜色
6. **类型安全**: 为所有 API 调用和组件 Props 添加 TypeScript 类型
7. **代码注释**: 为组件和复杂逻辑添加清晰的注释
